

<!DOCTYPE html>
<html class="writer-html5" lang="en-EN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.9. sail.BMImage &mdash; SOPHON-SAIL 3.10.2
 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01d1187f"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.10. sail.BMImageArray" href="sail.BMImageArray.html" />
    <link rel="prev" title="5.8. sail.bm_image" href="sail.bm_image.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SOPHON-SAIL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Catalog</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_disclaimer.html">1. Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_sail.html">2. SAIL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_build.html">3. Compilation and Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_module_cpp.html">4. SAIL C++ API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../5_module_python.html">5. SAIL Python API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Basicfunction.html">5.1. Basic function</a></li>
<li class="toctree-l2"><a class="reference internal" href="0_enum_type/enum_index.html">5.2. SAIL enum type</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Handle.html">5.3. sail.Handle</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Tensor.html">5.4. sail.Tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.PaddingAtrr.html">5.5. sail.PaddingAtrr</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Engine.html">5.6. sail.Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.MultiEngine.html">5.7. sail.MultiEngine</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.bm_image.html">5.8. sail.bm_image</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.9. sail.BMImage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#init">5.9.1. __init__</a></li>
<li class="toctree-l3"><a class="reference internal" href="#width">5.9.2. width</a></li>
<li class="toctree-l3"><a class="reference internal" href="#height">5.9.3. height</a></li>
<li class="toctree-l3"><a class="reference internal" href="#format">5.9.4. format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dtype">5.9.5. dtype</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">5.9.6. data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-device-id">5.9.7. get_device_id</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-handle">5.9.8. get_handle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asmat">5.9.9. asmat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asnumpy">5.9.10. asnumpy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-plane-num">5.9.11. get_plane_num</a></li>
<li class="toctree-l3"><a class="reference internal" href="#align">5.9.12. align</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-align">5.9.13. check_align</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unalign">5.9.14. unalign</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-contiguous-memory">5.9.15. check_contiguous_memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-pts-dts">5.9.16. get_pts_dts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sail.BMImageArray.html">5.10. sail.BMImageArray</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Decoder.html">5.11. sail.Decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Encoder.html">5.12. sail.Encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Decoder_RawStream.html">5.13. sail.Decoder_RawStream</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Bmcv.html">5.14. sail.Bmcv</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Blend.html">5.15. sail.Blend</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.MultiDecoder.html">5.16. sail.MultiDecoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_high_perform_interface/high_perform_index.html">5.17. SAIL Python high performance interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../6_appendix.html">6. Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SOPHON-SAIL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../5_module_python.html"><span class="section-number">5. </span>SAIL Python API</a></li>
      <li class="breadcrumb-item active"><span class="section-number">5.9. </span>sail.BMImage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/module_python/sail.BMImage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sail-bmimage">
<h1><span class="section-number">5.9. </span>sail.BMImage<a class="headerlink" href="#sail-bmimage" title="Link to this heading"></a></h1>
<section id="init">
<h2><span class="section-number">5.9.1. </span>__init__<a class="headerlink" href="#init" title="Link to this heading"></a></h2>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">handle</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">,</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="nb">format</span><span class="p">:</span> <span class="n">bm_image_format_ext</span><span class="p">,</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">bm_image_data_format_ext</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">,</span>
             <span class="n">buffer</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
             <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="nb">format</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="p">,</span>
             <span class="n">dtype</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">ImgDtype</span> <span class="o">=</span> <span class="n">DATA_TYPE_EXT_1N_BYTE</span><span class="p">,</span>
             <span class="n">strides</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters</strong></p>
<ul class="simple">
<li><p>handle : sail.Handle</p></li>
</ul>
<p>Handle instance</p>
<ul class="simple">
<li><p>h: int</p></li>
</ul>
<p>The height of img</p>
<ul class="simple">
<li><p>w: int</p></li>
</ul>
<p>The width of img</p>
<ul class="simple">
<li><p>format : bm_image_format_ext</p></li>
</ul>
<p>The pixel format of img.
Supported formats are listed in <a class="reference external" href="0_enum_type/sail.Format.html">sail.Format</a> .</p>
<ul class="simple">
<li><p>dtype: sail.bm_image_data_format_ext</p></li>
</ul>
<p>The data type of img.
Supported data types are listed in <a class="reference external" href="0_enum-type/sail.ImgDtype.html">ImgDtype</a> .</p>
<ul class="simple">
<li><p>buffer: bytes | np.array</p></li>
</ul>
<p>The buffer used to create a BMImage, which contains pixel values</p>
<ul class="simple">
<li><p>strides</p></li>
</ul>
<p>The stride of the image when creating an image with a buffer. The unit is in bytes.
The default is empty, indicating that it is the same as the data width of one row.
If specified, ensure the number of elements in the list matches the number of image planes.</p>
<ul class="simple">
<li><p>offset</p></li>
</ul>
<p>The offset of valid data relative to the start address of the buffer when creating an image with a buffer.
The unit is in bytes, and the default is 0.</p>
</section>
<section id="width">
<h2><span class="section-number">5.9.2. </span>width<a class="headerlink" href="#width" title="Link to this heading"></a></h2>
<p>Get the img width.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>width : int</p></li>
</ul>
<p>The width of img</p>
</section>
<section id="height">
<h2><span class="section-number">5.9.3. </span>height<a class="headerlink" href="#height" title="Link to this heading"></a></h2>
<p>Get the img height.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>height : int</p></li>
</ul>
<p>The height of img</p>
</section>
<section id="format">
<h2><span class="section-number">5.9.4. </span>format<a class="headerlink" href="#format" title="Link to this heading"></a></h2>
<p>Get the img format.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">bm_image_format_ext</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>format : bm_image_format_ext</p></li>
</ul>
<p>The format of img</p>
</section>
<section id="dtype">
<h2><span class="section-number">5.9.5. </span>dtype<a class="headerlink" href="#dtype" title="Link to this heading"></a></h2>
<p>Get the img dtype.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">bm_image_data_format_ext</span>
</pre></div>
</div>
</dd>
</dl>
<p>Returns</p>
<ul class="simple">
<li><p>dtype: bm_image_data_format_ext</p></li>
</ul>
<p>The data type of img</p>
</section>
<section id="data">
<h2><span class="section-number">5.9.6. </span>data<a class="headerlink" href="#data" title="Link to this heading"></a></h2>
<p>Get inner bm_image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">bm_image</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>img : bm_image</p></li>
</ul>
<p>the data of img</p>
</section>
<section id="get-device-id">
<h2><span class="section-number">5.9.7. </span>get_device_id<a class="headerlink" href="#get-device-id" title="Link to this heading"></a></h2>
<p>Get device id of this image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_device_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>device_id : int</p></li>
</ul>
<p>Tensor Computing Processor ids of this image.</p>
</section>
<section id="get-handle">
<h2><span class="section-number">5.9.8. </span>get_handle<a class="headerlink" href="#get-handle" title="Link to this heading"></a></h2>
<p>Get Handle of BMImage.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Return:</strong></p>
<ul class="simple">
<li><p>Handle : Handle</p></li>
</ul>
<p>Return the Handle of BMImage.</p>
</section>
<section id="asmat">
<h2><span class="section-number">5.9.9. </span>asmat<a class="headerlink" href="#asmat" title="Link to this heading"></a></h2>
<p>Convert to cv Mat</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">asmat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>image : numpy.ndarray[numpy.uint8]</p></li>
</ul>
<p>only support uint8</p>
</section>
<section id="asnumpy">
<h2><span class="section-number">5.9.10. </span>asnumpy<a class="headerlink" href="#asnumpy" title="Link to this heading"></a></h2>
<p>Convert BMImage’s data to numpy.ndarray, with original pixel format.</p>
<p>Supported pixel formats are listed in <a class="reference external" href="0_enum_type/sail.Format.html">sail.Format</a> .</p>
<p>Supported data type are DATA_TYPE_EXT_1N_BYTE、DATA_TYPE_EXT_1N_BYTE_SIGNED和DATA_TYPE_EXT_FLOAT32.</p>
<p>The returned ndarray’s shape is corresponding to BMImage’s pixel format.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pixel format</p></th>
<th class="head"><p>ndarray’s shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FORMAT_BGR_PACKED / FORMAT_BGR_PACKED</p></td>
<td><p>(height, width, 3)</p></td>
</tr>
<tr class="row-odd"><td><p>FORMAT_ARGB_PACKED / FORMAT_ABGR_PACKED</p></td>
<td><p>(height, width, 4)</p></td>
</tr>
<tr class="row-even"><td><p>FORMAT_GRAY</p></td>
<td><p>(1, height, width)</p></td>
</tr>
<tr class="row-odd"><td><p>FORMAT_BGR_PLANAR / FORMAT_RGB_PLANAR</p></td>
<td><p>(3, height, width)</p></td>
</tr>
<tr class="row-even"><td><p>FORMAT_YUV444P</p></td>
<td><p>(3, height, width)</p></td>
</tr>
<tr class="row-odd"><td><p>else</p></td>
<td><p>(numel,)</p></td>
</tr>
</tbody>
</table>
<p>In above table, <code class="docutils literal notranslate"><span class="pre">numel</span></code> means the number of elements in BMImage.
For example,
if pixel format is YUV420P or NV12, numel = height * width * 1.5 ;
if pixel format is BGR_PACKED or BGR_PLANAR, numel = height * width * 3 .</p>
<dl>
<dt><strong>接口形式:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">asnumpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>返回值说明:</strong></p>
<ul class="simple">
<li><p>image : numpy.ndarray</p></li>
</ul>
<p>return data in BMImage.</p>
<dl>
<dt><strong>示例代码:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">devid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">devid</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">1080</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">1920</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">ImgDtype</span><span class="o">.</span><span class="n">DATA_TYPE_EXT_1N_BYTE</span>
    <span class="n">np_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>

    <span class="c1"># example for BGR_PLANAR</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_BGR_PLANAR</span>
    <span class="n">numel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">rawdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="n">numel</span><span class="p">,),</span> <span class="n">np_dtype</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">rawdata</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">out_ndarray</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">out_ndarray</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

    <span class="c1"># example for YUV420P</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_YUV420P</span>
    <span class="n">numel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">width</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">rawdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="n">numel</span><span class="p">,),</span> <span class="n">np_dtype</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">rawdata</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">out_ndarray</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">out_ndarray</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">numel</span><span class="p">,)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="get-plane-num">
<h2><span class="section-number">5.9.11. </span>get_plane_num<a class="headerlink" href="#get-plane-num" title="Link to this heading"></a></h2>
<p>Get plane number of this image</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_plane_num</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="align">
<h2><span class="section-number">5.9.12. </span>align<a class="headerlink" href="#align" title="Link to this heading"></a></h2>
<p>Align the bm_image to 64 bytes</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>ret : int</p></li>
</ul>
<p>return if BMImage aligned,-1 failed,0 successed</p>
</section>
<section id="check-align">
<h2><span class="section-number">5.9.13. </span>check_align<a class="headerlink" href="#check-align" title="Link to this heading"></a></h2>
<p>Check if the bm_image aligned</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">check_align</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>ret : bool</p></li>
</ul>
<p>return if BMImage aligned,1 aligned,0 unaligned</p>
</section>
<section id="unalign">
<h2><span class="section-number">5.9.14. </span>unalign<a class="headerlink" href="#unalign" title="Link to this heading"></a></h2>
<p>Unalign the bm_image to source bm_image</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">unalign</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>ret : int</p></li>
</ul>
<p>return if BMImage unaligned,-1 failed,0 successed</p>
</section>
<section id="check-contiguous-memory">
<h2><span class="section-number">5.9.15. </span>check_contiguous_memory<a class="headerlink" href="#check-contiguous-memory" title="Link to this heading"></a></h2>
<p>Check if the bm_image’s memory contiguous</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">check_contiguous_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>ret : bool</p></li>
</ul>
<p>return if BMImage memory contiguous,1 contiguous,0 uncontiguous</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;your_image.jpg&quot;</span> <span class="c1"># 请替换为您的文件路径</span>
    <span class="n">dev_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">BMimg</span><span class="p">)</span>

    <span class="c1"># get bm_image</span>
    <span class="n">bm_image</span> <span class="o">=</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>

    <span class="c1"># get BMimg width,height,dtype,format,device_id,plane_num,handle</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">BMimg</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">height</span><span class="p">(),</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">format</span><span class="p">(),</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">dtype</span><span class="p">(),</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">get_device_id</span><span class="p">(),</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">get_plane_num</span><span class="p">(),</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">get_handle</span><span class="p">())</span>

    <span class="c1"># get mat</span>
    <span class="n">np_data</span> <span class="o">=</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">asmat</span><span class="p">()</span>

    <span class="c1"># align BMimg</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">align</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;align success&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;align failed&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">BMimg</span><span class="o">.</span><span class="n">check_align</span><span class="p">())</span>

    <span class="c1"># unalign BMimg</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">BMimg</span><span class="o">.</span><span class="n">unalign</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unalign success&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unalign failed&quot;</span><span class="p">)</span>

    <span class="c1"># check contiguous memory</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">BMimg</span><span class="o">.</span><span class="n">check_contiguous_memory</span><span class="p">())</span>

    <span class="c1"># create BMImage with data from buffer</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">i</span> <span class="o">%</span> <span class="mi">256</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">200</span><span class="o">*</span><span class="mi">100</span><span class="o">*</span><span class="mi">3</span><span class="p">))])</span>
    <span class="n">img_fromRawdata</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_BGR_PACKED</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="get-pts-dts">
<h2><span class="section-number">5.9.16. </span>get_pts_dts<a class="headerlink" href="#get-pts-dts" title="Link to this heading"></a></h2>
<p>Get pts and dts.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_pts_dts</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns</strong></p>
<ul class="simple">
<li><p>result : list</p></li>
</ul>
<p>the value of pts and dts.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">input_file_path</span> <span class="o">=</span> <span class="s1">&#39;your_rtsp_url&#39;</span>
    <span class="n">dev_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frame read successfully into bm_image&quot;</span><span class="p">)</span>
        <span class="n">pts</span><span class="p">,</span><span class="n">dts</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">get_pts_dts</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pts:&quot;</span><span class="p">,</span><span class="n">pts</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dts:&quot;</span><span class="p">,</span><span class="n">dts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to read frame into bm_image&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sail.bm_image.html" class="btn btn-neutral float-left" title="5.8. sail.bm_image" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sail.BMImageArray.html" class="btn btn-neutral float-right" title="5.10. sail.BMImageArray" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SOPHGO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>