

<!DOCTYPE html>
<html class="writer-html5" lang="en-EN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.14. sail.Bmcv &mdash; SOPHON-SAIL 3.10.2
 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01d1187f"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.15. sail.Blend" href="sail.Blend.html" />
    <link rel="prev" title="5.13. sail.Decoder_RawStream" href="sail.Decoder_RawStream.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SOPHON-SAIL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Catalog</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_disclaimer.html">1. Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_sail.html">2. SAIL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_build.html">3. Compilation and Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_module_cpp.html">4. SAIL C++ API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../5_module_python.html">5. SAIL Python API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Basicfunction.html">5.1. Basic function</a></li>
<li class="toctree-l2"><a class="reference internal" href="0_enum_type/enum_index.html">5.2. SAIL enum type</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Handle.html">5.3. sail.Handle</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Tensor.html">5.4. sail.Tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.PaddingAtrr.html">5.5. sail.PaddingAtrr</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Engine.html">5.6. sail.Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.MultiEngine.html">5.7. sail.MultiEngine</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.bm_image.html">5.8. sail.bm_image</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.BMImage.html">5.9. sail.BMImage</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.BMImageArray.html">5.10. sail.BMImageArray</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Decoder.html">5.11. sail.Decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Encoder.html">5.12. sail.Encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.Decoder_RawStream.html">5.13. sail.Decoder_RawStream</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.14. sail.Bmcv</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#init">5.14.1. __init__</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bm-image-to-tensor">5.14.2. bm_image_to_tensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tensor-to-bm-image">5.14.3. tensor_to_bm_image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#crop-and-resize">5.14.4. crop_and_resize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#crop">5.14.5. crop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resize">5.14.6. resize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-crop-and-resize">5.14.7. vpp_crop_and_resize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-crop-and-resize-padding">5.14.8. vpp_crop_and_resize_padding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-crop">5.14.9. vpp_crop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-resize">5.14.10. vpp_resize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-resize-padding">5.14.11. vpp_resize_padding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#warp">5.14.12. warp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#convert-to">5.14.13. convert_to</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yuv2bgr">5.14.14. yuv2bgr</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rectangle">5.14.15. rectangle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fillrectangle">5.14.16. fillRectangle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imwrite">5.14.17. imwrite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imread">5.14.18. imread</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-handle">5.14.19. get_handle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#crop-and-resize-padding">5.14.20. crop_and_resize_padding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#convert-format">5.14.21. convert_format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-convert-format">5.14.22. vpp_convert_format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#puttext">5.14.23. putText</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-add-weighted">5.14.24. image_add_weighted</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-copy-to">5.14.25. image_copy_to</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-copy-to-padding">5.14.26. image_copy_to_padding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nms">5.14.27. nms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#drawpoint">5.14.28. drawPoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#warp-perspective">5.14.29. warp_perspective</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-bm-data-type">5.14.30. get_bm_data_type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-bm-image-data-format">5.14.31. get_bm_image_data_format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imdecode">5.14.32. imdecode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imencode">5.14.33. imencode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fft">5.14.34. fft</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mat-to-bm-image">5.14.35. mat_to_bm_image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#polylines">5.14.36. polylines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mosaic">5.14.37. mosaic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gaussian-blur">5.14.38. gaussian_blur</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transpose">5.14.39. transpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#watermark-superpose">5.14.40. watermark_superpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sobel">5.14.41. Sobel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#drawlines">5.14.42. drawLines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stft">5.14.43. stft</a></li>
<li class="toctree-l3"><a class="reference internal" href="#istft">5.14.44. istft</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bmcv-overlay">5.14.45. bmcv_overlay</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faiss-indexflatl2">5.14.46. faiss_indexflatL2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faiss-indexflatip">5.14.47. faiss_indexflatIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faiss-indexpq-encode">5.14.48. faiss_indexPQ_encode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faiss-indexpq-adc">5.14.49. faiss_indexPQ_ADC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faiss-indexpq-sdc">5.14.50. faiss_indexPQ_SDC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sail.Blend.html">5.15. sail.Blend</a></li>
<li class="toctree-l2"><a class="reference internal" href="sail.MultiDecoder.html">5.16. sail.MultiDecoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_high_perform_interface/high_perform_index.html">5.17. SAIL Python high performance interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../6_appendix.html">6. Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SOPHON-SAIL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../5_module_python.html"><span class="section-number">5. </span>SAIL Python API</a></li>
      <li class="breadcrumb-item active"><span class="section-number">5.14. </span>sail.Bmcv</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/module_python/sail.Bmcv.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sail-bmcv">
<h1><span class="section-number">5.14. </span>sail.Bmcv<a class="headerlink" href="#sail-bmcv" title="Link to this heading"></a></h1>
<section id="init">
<h2><span class="section-number">5.14.1. </span>__init__<a class="headerlink" href="#init" title="Link to this heading"></a></h2>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* handle : sail.Handle</p>
<p>Handle instance</p>
</section>
<section id="bm-image-to-tensor">
<h2><span class="section-number">5.14.2. </span>bm_image_to_tensor<a class="headerlink" href="#bm-image-to-tensor" title="Link to this heading"></a></h2>
<p>Convert image to tensor.</p>
<dl>
<dt><strong>Interface1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bm_image_to_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* image : sail.BMImage | sail.BMImageArray</p>
<p>BMImage/BMImageArray instance</p>
<p><strong>Returns:</strong>
Return sail.Tensor instance</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">bm_image_to_tensor</span><span class="p">(</span><span class="n">BMimg</span><span class="p">)</span><span class="c1"># here is a sail.Tensor</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface2:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bm_image_to_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                    <span class="n">tensor</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* image : sail.BMImage | sail.BMImageArray</p>
<p>BMImage/BMImageArray instance</p>
<ul class="simple">
<li><p>tensor : sail.Tensor</p></li>
</ul>
<p>Tensor instance</p>
<blockquote>
<div><p><strong>Sample:</strong>
.. code-block:: python</p>
<blockquote>
<div><p>import sophon.sail as sail</p>
<dl class="simple">
<dt>if __name__ == ‘__main__’:</dt><dd><p>tpu_id = 0
handle = sail.Handle(tpu_id)
image_name = “your_image_path”
decoder = sail.Decoder(image_name,True,tpu_id)
BMimg = decoder.read(handle)# here is a sail.BMImage
bmcv = sail.Bmcv(handle)
tensor = sail.Tensor(handle,(1920,1080),sail.Dtype.BM_FLOAT32,True,True)
bmcv.bm_image_to_tensor(BMimg,tensor)</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</section>
<section id="tensor-to-bm-image">
<h2><span class="section-number">5.14.3. </span>tensor_to_bm_image<a class="headerlink" href="#tensor-to-bm-image" title="Link to this heading"></a></h2>
<p>Convert tensor to image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tensor_to_bm_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">tensor</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                    <span class="n">bgr2rgb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">layout</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;nchw&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* tensor : sail.Tensor</p>
<p>Tensor instance</p>
<ul class="simple">
<li><p>bgr2rgb : bool</p></li>
</ul>
<p>Swap color channel, default: False</p>
<ul class="simple">
<li><p>layout : str</p></li>
</ul>
<p>Layout of the input tensor</p>
<p><strong>Returns:</strong>
Return BMImage instance</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">bm_image_to_tensor</span><span class="p">(</span><span class="n">BMimg</span><span class="p">)</span><span class="c1"># here is a sail.Tensor</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">tensor_to_bm_image</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tensor_to_bm_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">tensor</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* tensor : sail.Tensor</p>
<p>Tensor instance</p>
<ul class="simple">
<li><p>format : sail.Format</p></li>
</ul>
<p>Format of the BMImage</p>
<p><strong>Returns:</strong>
Return BMImage instance</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">bm_image_to_tensor</span><span class="p">(</span><span class="n">BMimg</span><span class="p">)</span><span class="c1"># here is a sail.Tensor</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">tensor_to_bm_image</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_BGR_PLANAR</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tensor_to_bm_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">tensor</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                    <span class="n">img</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                    <span class="n">bgr2rgb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">layout</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;nchw&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* tensor : sail.Tensor</p>
<p>Tensor instance</p>
<ul class="simple">
<li><p>img : sail.BMImage</p></li>
</ul>
<p>BMImage instance</p>
<ul class="simple">
<li><p>bgr2rgb : bool</p></li>
</ul>
<p>Swap color channel, default: False</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">bm_image_to_tensor</span><span class="p">(</span><span class="n">BMimg</span><span class="p">)</span><span class="c1"># here is a sail.Tensor</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">tensor_to_bm_image</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span><span class="n">BMimg2</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tensor_to_bm_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">tensor</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                    <span class="n">img</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* tensor : sail.Tensor</p>
<p>Tensor instance</p>
<ul class="simple">
<li><p>img : sail.BMImage</p></li>
</ul>
<p>BMImage instance</p>
<ul class="simple">
<li><p>format : sail.Format</p></li>
</ul>
<p>Format of the BMImage</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">bm_image_to_tensor</span><span class="p">(</span><span class="n">BMimg</span><span class="p">)</span><span class="c1"># here is a sail.Tensor</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">tensor_to_bm_image</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span><span class="n">BMimg2</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_BGR_PLANAR</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="crop-and-resize">
<h2><span class="section-number">5.14.4. </span>crop_and_resize<a class="headerlink" href="#crop-and-resize" title="Link to this heading"></a></h2>
<p>Crop then resize an image or an image array.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">crop_and_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="o">|</span><span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                    <span class="n">crop_x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">crop_y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">crop_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">crop_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span>
                    <span class="p">)</span><span class="o">-&gt;</span><span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* input : sail.BMImage|sail.BMImageArray,</p>
<p>Input image or image array</p>
<ul class="simple">
<li><p>crop_x0 : int</p></li>
</ul>
<p>Start point x of the crop window</p>
<ul class="simple">
<li><p>crop_y0 : int</p></li>
</ul>
<p>Start point y of the crop window</p>
<ul class="simple">
<li><p>crop_w : int</p></li>
</ul>
<p>Width of the crop window</p>
<ul class="simple">
<li><p>crop_h : int</p></li>
</ul>
<p>Height of the crop window</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">BMimg3</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">crop_and_resize</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">BMimg</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span><span class="n">BMimg</span><span class="o">.</span><span class="n">height</span><span class="p">(),</span><span class="mi">640</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="n">sail</span><span class="o">.</span><span class="n">bmcv_resize_algorithm</span><span class="o">.</span><span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="crop">
<h2><span class="section-number">5.14.5. </span>crop<a class="headerlink" href="#crop" title="Link to this heading"></a></h2>
<p>Crop an image or an image array with given window.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
        <span class="n">crop_x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">crop_y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">crop_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">crop_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* input : sail.BMImage</p>
<p>Input image</p>
<ul class="simple">
<li><p>crop_x0 : int</p></li>
</ul>
<p>Start point x of the crop window</p>
<ul class="simple">
<li><p>crop_y0 : int</p></li>
</ul>
<p>Start point y of the crop window</p>
<ul class="simple">
<li><p>crop_w : int</p></li>
</ul>
<p>Width of the crop window</p>
<ul class="simple">
<li><p>crop_h : int</p></li>
</ul>
<p>Height of the crop window</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>Output image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">crop_x0</span><span class="p">,</span> <span class="n">crop_y0</span><span class="p">,</span> <span class="n">crop_w</span><span class="p">,</span> <span class="n">crop_h</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span>
    <span class="n">cropped_BMimg</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="n">crop_x0</span><span class="p">,</span> <span class="n">crop_y0</span><span class="p">,</span> <span class="n">crop_w</span><span class="p">,</span> <span class="n">crop_h</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">crop_x0</span><span class="p">,</span> <span class="n">crop_y0</span><span class="p">,</span> <span class="n">crop_w</span><span class="p">,</span> <span class="n">crop_h</span><span class="p">):</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* input : sail.BMImageArray</p>
<p>Input image array</p>
<ul class="simple">
<li><p>crop_x0 : int</p></li>
</ul>
<p>Start point x of the crop window</p>
<ul class="simple">
<li><p>crop_y0 : int</p></li>
</ul>
<p>Start point y of the crop window</p>
<ul class="simple">
<li><p>crop_w : int</p></li>
</ul>
<p>Width of the crop window</p>
<ul class="simple">
<li><p>crop_h : int</p></li>
</ul>
<p>Height of the crop window</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImageArray</p></li>
</ul>
<p>Output image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">rects</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>
        <span class="c1">#...more</span>
    <span class="p">]</span>
    <span class="n">cropped_images_list</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="n">rects</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="resize">
<h2><span class="section-number">5.14.6. </span>resize<a class="headerlink" href="#resize" title="Link to this heading"></a></h2>
<p>Resize an image or an image array</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
        <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* input : sail.BMImage | sail.BMImageArray</p>
<p>Input image or image array</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">BMimg_resize</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="n">resize_alg</span><span class="o">=</span><span class="n">sail</span><span class="o">.</span><span class="n">bmcv_resize_algorithm</span><span class="o">.</span><span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="vpp-crop-and-resize">
<h2><span class="section-number">5.14.7. </span>vpp_crop_and_resize<a class="headerlink" href="#vpp-crop-and-resize" title="Link to this heading"></a></h2>
<p>Crop then resize an image or an image array using vpp</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_crop_and_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                        <span class="n">crop_x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">crop_y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">crop_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">crop_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* input : sail.BMImage | sail.BMImageArray</p>
<p>Input image or image array</p>
<ul class="simple">
<li><p>crop_x0 : int</p></li>
</ul>
<p>Start point x of the crop window</p>
<ul class="simple">
<li><p>crop_y0 : int</p></li>
</ul>
<p>Start point y of the crop window</p>
<ul class="simple">
<li><p>crop_w : int</p></li>
</ul>
<p>Width of the crop window</p>
<ul class="simple">
<li><p>crop_h : int</p></li>
</ul>
<p>Height of the crop window</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">crop_x0</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">crop_y0</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">crop_w</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">crop_h</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">resize_w</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">resize_h</span> <span class="o">=</span> <span class="mi">300</span>

    <span class="n">resized_BMimg</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_crop_and_resize</span><span class="p">(</span>
        <span class="n">BMimg</span><span class="p">,</span>
        <span class="n">crop_x0</span><span class="p">,</span>
        <span class="n">crop_y0</span><span class="p">,</span>
        <span class="n">crop_w</span><span class="p">,</span>
        <span class="n">crop_h</span><span class="p">,</span>
        <span class="n">resize_w</span><span class="p">,</span>
        <span class="n">resize_h</span><span class="p">,</span>
        <span class="n">sail</span><span class="o">.</span><span class="n">bmcv_resize_algorithm</span><span class="o">.</span><span class="n">BMCV_INTER_NEAREST</span>
    <span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="vpp-crop-and-resize-padding">
<h2><span class="section-number">5.14.8. </span>vpp_crop_and_resize_padding<a class="headerlink" href="#vpp-crop-and-resize-padding" title="Link to this heading"></a></h2>
<p>Crop then resize an image or an image array using vpp.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_crop_and_resize_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                                <span class="n">crop_x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">crop_y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">crop_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">crop_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">padding</span><span class="p">:</span> <span class="n">PaddingAtrr</span><span class="p">,</span>
                                <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<ul class="simple">
<li><p>crop_x0 : int</p></li>
</ul>
<p>Start point x of the crop window</p>
<ul class="simple">
<li><p>crop_y0 : int</p></li>
</ul>
<p>Start point y of the crop window</p>
<ul class="simple">
<li><p>crop_w : int</p></li>
</ul>
<p>Width of the crop window</p>
<ul class="simple">
<li><p>crop_h : int</p></li>
</ul>
<p>Height of the crop window</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>padding : PaddingAtrr</p></li>
</ul>
<p>padding info</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<p><strong>Returns:</strong>
* output : sail.BMImage | sail.BMImageArray</p>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">paddingatt</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">PaddingAtrr</span><span class="p">()</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_stx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_sty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_w</span><span class="p">(</span><span class="mi">640</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_h</span><span class="p">(</span><span class="mi">640</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_r</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_g</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_b</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">BMimg4</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_crop_and_resize_padding</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">BMimg</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span><span class="n">BMimg</span><span class="o">.</span><span class="n">height</span><span class="p">(),</span><span class="mi">640</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="n">paddingatt</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="vpp-crop">
<h2><span class="section-number">5.14.9. </span>vpp_crop<a class="headerlink" href="#vpp-crop" title="Link to this heading"></a></h2>
<p>Crop an image or an image array with given window using vpp.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
            <span class="n">crop_x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">crop_y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">crop_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">crop_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong>
* input : sail.BMImage | sail.BMImageArray</p>
<p>Input image or image array</p>
<ul class="simple">
<li><p>crop_x0 : int</p></li>
</ul>
<p>Start point x of the crop window</p>
<ul class="simple">
<li><p>crop_y0 : int</p></li>
</ul>
<p>Start point y of the crop window</p>
<ul class="simple">
<li><p>crop_w : int</p></li>
</ul>
<p>Width of the crop window</p>
<ul class="simple">
<li><p>crop_h : int</p></li>
</ul>
<p>Height of the crop window</p>
<p><strong>Returns:</strong>
* output : sail.BMImage | sail.BMImageArray</p>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">crop_x0</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">crop_y0</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">crop_w</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">crop_h</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">BMimg4</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_crop</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="n">crop_x0</span><span class="p">,</span><span class="n">crop_y0</span><span class="p">,</span><span class="n">crop_w</span><span class="p">,</span><span class="n">crop_h</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="vpp-resize">
<h2><span class="section-number">5.14.10. </span>vpp_resize<a class="headerlink" href="#vpp-resize" title="Link to this heading"></a></h2>
<p>Resize an image or an image array with interpolation of INTER_NEAREST using vpp.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
            <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">BMimg_resize</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_resize</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="n">resize_alg</span><span class="o">=</span><span class="n">sail</span><span class="o">.</span><span class="n">bmcv_resize_algorithm</span><span class="o">.</span><span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                <span class="n">output</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image</p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">BMimg_resize</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_resize</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="n">BMimg_resize</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="n">resize_alg</span><span class="o">=</span><span class="n">sail</span><span class="o">.</span><span class="n">bmcv_resize_algorithm</span><span class="o">.</span><span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="vpp-resize-padding">
<h2><span class="section-number">5.14.11. </span>vpp_resize_padding<a class="headerlink" href="#vpp-resize-padding" title="Link to this heading"></a></h2>
<p>Resize an image or an image array with interpolation of INTER_NEAREST using vpp.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_resize_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                    <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">padding</span><span class="p">:</span> <span class="n">PaddingAtrr</span><span class="p">,</span>
                    <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>padding : PaddingAtrr</p></li>
</ul>
<p>padding info</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>  <span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">paddingatt</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">PaddingAtrr</span><span class="p">()</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_stx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_sty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_w</span><span class="p">(</span><span class="mi">640</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_h</span><span class="p">(</span><span class="mi">640</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_r</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_g</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_b</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">BMimg4</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_resize_padding</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="n">paddingatt</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="warp">
<h2><span class="section-number">5.14.12. </span>warp<a class="headerlink" href="#warp" title="Link to this heading"></a></h2>
<p>Applies an affine transformation to an image or an image array.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">warp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="mi">2</span><span class="n">d</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">use_bilinear</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">similar_to_opencv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<ul class="simple">
<li><p>matrix: 2d list</p></li>
</ul>
<p>2x3 transformation matrix</p>
<ul class="simple">
<li><p>use_bilinear: int</p></li>
</ul>
<p>Whether to use bilinear interpolation, default to 0 using nearest neighbor interpolation, 1 being bilinear interpolation</p>
<ul class="simple">
<li><p>similar_to_opencv: bool</p></li>
</ul>
<p>Whether to use the interface aligning the affine transformation interface of OpenCV</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">rotated_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.9996914396</span><span class="p">,</span><span class="o">-</span><span class="mf">0.02484</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mf">0.02484</span><span class="p">,</span><span class="mf">0.9996914396</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">BMimg6</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="n">rotated_matrix</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">warp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="mi">2</span><span class="n">d</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">use_bilinear</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">similar_to_opencv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<ul class="simple">
<li><p>matrix: 2d list</p></li>
</ul>
<p>2x3 transformation matrix</p>
<ul class="simple">
<li><p>use_bilinear: int</p></li>
</ul>
<p>Whether to use bilinear interpolation, default to 0 using nearest neighbor interpolation, 1 being bilinear interpolation</p>
<ul class="simple">
<li><p>similar_to_opencv: bool</p></li>
</ul>
<p>Whether to use the interface aligning the affine transformation interface of OpenCV</p>
<p><strong>Returns:</strong></p>
<p>0 for success and others for failure</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">rotated_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.9996914396</span><span class="p">,</span><span class="o">-</span><span class="mf">0.02484</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mf">0.02484</span><span class="p">,</span><span class="mf">0.9996914396</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span><span class="n">rotated_matrix</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="convert-to">
<h2><span class="section-number">5.14.13. </span>convert_to<a class="headerlink" href="#convert-to" title="Link to this heading"></a></h2>
<p>Applies a linear transformation to an image or an image array.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                <span class="n">alpha_beta</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<ul class="simple">
<li><p>alpha_beta: tuple</p></li>
</ul>
<p>(a0, b0), (a1, b1), (a2, b2) factors</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">alpha_beta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">BMimg5</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">convert_to</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="n">alpha_beta</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                <span class="n">output</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">,</span>
                <span class="n">alpha_beta</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<ul class="simple">
<li><p>alpha_beta: tuple</p></li>
</ul>
<p>(a0, b0), (a1, b1), (a2, b2) factors</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">alpha_beta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">BMimg5</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">convert_to</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="n">BMimg5</span><span class="p">,</span><span class="n">alpha_beta</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="yuv2bgr">
<h2><span class="section-number">5.14.14. </span>yuv2bgr<a class="headerlink" href="#yuv2bgr" title="Link to this heading"></a></h2>
<p>Convert an image or an image array from YUV to BGR.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">yuv2bgr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span> <span class="o">|</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImageArray</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Input image or image array</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.BMImageArray</p></li>
</ul>
<p>Output image or image array</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">BMimg5</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">yuv2bgr</span><span class="p">(</span><span class="n">BMimg</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="rectangle">
<h2><span class="section-number">5.14.15. </span>rectangle<a class="headerlink" href="#rectangle" title="Link to this heading"></a></h2>
<p>Draw a rectangle on input image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
            <span class="n">x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">bm_image</span><span class="p">,</span>
                <span class="n">x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
                <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>image : sail.BMImage | sail.bm_image</p></li>
</ul>
<p>Input image</p>
<ul class="simple">
<li><p>x0 : int</p></li>
</ul>
<p>Start point x of rectangle</p>
<ul class="simple">
<li><p>y0 : int</p></li>
</ul>
<p>Start point y of rectangle</p>
<ul class="simple">
<li><p>w : int</p></li>
</ul>
<p>Width of rectangle</p>
<ul class="simple">
<li><p>h : int</p></li>
</ul>
<p>Height of rectangle</p>
<ul class="simple">
<li><p>color : tuple</p></li>
</ul>
<p>Color of rectangle</p>
<ul class="simple">
<li><p>thickness : int</p></li>
</ul>
<p>Thickness of rectangle, default: 1</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>process_status : int</p></li>
</ul>
<p>0 for success and others for failure</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="fillrectangle">
<h2><span class="section-number">5.14.16. </span>fillRectangle<a class="headerlink" href="#fillrectangle" title="Link to this heading"></a></h2>
<p>Fill a rectangle on input image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fillRectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
            <span class="n">x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fillRectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">bm_image</span><span class="p">,</span>
            <span class="n">x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>image : sail.BMImage | sail.bm_image</p></li>
</ul>
<p>Input image</p>
<ul class="simple">
<li><p>x0 : int</p></li>
</ul>
<p>Start point x of rectangle</p>
<ul class="simple">
<li><p>y0 : int</p></li>
</ul>
<p>Start point y of rectangle</p>
<ul class="simple">
<li><p>w : int</p></li>
</ul>
<p>Width of rectangle</p>
<ul class="simple">
<li><p>h : int</p></li>
</ul>
<p>Height of rectangle</p>
<ul class="simple">
<li><p>color : tuple</p></li>
</ul>
<p>Color of rectangle</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>process_status : int</p></li>
</ul>
<p>0 for success and others for failure</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">fillRectangle</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="imwrite">
<h2><span class="section-number">5.14.17. </span>imwrite<a class="headerlink" href="#imwrite" title="Link to this heading"></a></h2>
<p>Save the image to the specified file.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">imwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>

<span class="k">def</span><span class="w"> </span><span class="nf">imwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">bm_image</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>file_name : str</p></li>
</ul>
<p>Name of the file</p>
<ul class="simple">
<li><p>output : sail.BMImage | sail.bm_image</p></li>
</ul>
<p>Image to be saved</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>process_status : int</p></li>
</ul>
<p>0 for success and others for failure</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.jpg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">BMimg</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span><span class="n">BMimg</span><span class="o">.</span><span class="n">height</span><span class="p">()),</span><span class="n">BMimg</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="imread">
<h2><span class="section-number">5.14.18. </span>imread<a class="headerlink" href="#imread" title="Link to this heading"></a></h2>
<p>Read and decode one image files and supports hard decoding only for JPEG baseline format. For other formats, such as PNG and BMP, soft decoding is used.
The returned BMImage for JPEG baseline images keeps YUV color space, and the pixel format depends on the sampling information in the file like YUV420.
The returned BMImage for other formats will maintain the corresponding color space of their input.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">imread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>filename : str</p></li>
</ul>
<p>Name of file to be read.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>The decoded image.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="get-handle">
<h2><span class="section-number">5.14.19. </span>get_handle<a class="headerlink" href="#get-handle" title="Link to this heading"></a></h2>
<p>Get Handle instance.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>handle: sail.Handle</p></li>
</ul>
<p>Handle instance</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">handle1</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">get_handle</span><span class="p">()</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="crop-and-resize-padding">
<h2><span class="section-number">5.14.20. </span>crop_and_resize_padding<a class="headerlink" href="#crop-and-resize-padding" title="Link to this heading"></a></h2>
<p>Crop then resize an image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">crop_and_resize_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
                            <span class="n">crop_x0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">crop_y0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">crop_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">crop_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">resize_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">resize_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">padding</span><span class="p">:</span> <span class="n">PaddingAtrr</span><span class="p">,</span>
                            <span class="n">resize_alg</span><span class="p">:</span> <span class="n">bmcv_resize_algorithm</span> <span class="o">=</span> <span class="n">BMCV_INTER_NEAREST</span>
                            <span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage</p></li>
</ul>
<p>Input image</p>
<ul class="simple">
<li><p>crop_x0 : int</p></li>
</ul>
<p>Start point x of the crop window</p>
<ul class="simple">
<li><p>crop_y0 : int</p></li>
</ul>
<p>Start point y of the crop window</p>
<ul class="simple">
<li><p>crop_w : int</p></li>
</ul>
<p>Width of the crop window</p>
<ul class="simple">
<li><p>crop_h : int</p></li>
</ul>
<p>Height of the crop window</p>
<ul class="simple">
<li><p>resize_w : int</p></li>
</ul>
<p>Target width</p>
<ul class="simple">
<li><p>resize_h : int</p></li>
</ul>
<p>Target height</p>
<ul class="simple">
<li><p>padding : PaddingAtrr</p></li>
</ul>
<p>padding info</p>
<ul class="simple">
<li><p>resize_alg : bmcv_resize_algorithm</p></li>
</ul>
<p>Resize algorithm, default is BMCV_INTER_NEAREST</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>Output image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">crop_x0</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">crop_y0</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">crop_w</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">crop_h</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">resize_w</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">resize_h</span> <span class="o">=</span> <span class="mi">300</span>

    <span class="n">paddingatt</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">PaddingAtrr</span><span class="p">()</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_stx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_sty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_w</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_h</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_r</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_g</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">paddingatt</span><span class="o">.</span><span class="n">set_b</span><span class="p">(</span><span class="mi">114</span><span class="p">)</span>
    <span class="n">padded_BMimg</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">crop_and_resize_padding</span><span class="p">(</span>
        <span class="n">BMimg</span><span class="p">,</span>
        <span class="n">crop_x0</span><span class="p">,</span>
        <span class="n">crop_y0</span><span class="p">,</span>
        <span class="n">crop_w</span><span class="p">,</span>
        <span class="n">crop_h</span><span class="p">,</span>
        <span class="n">resize_w</span><span class="p">,</span>
        <span class="n">resize_h</span><span class="p">,</span>
        <span class="n">paddingatt</span><span class="p">,</span>
        <span class="n">sail</span><span class="o">.</span><span class="n">bmcv_resize_algorithm</span><span class="o">.</span><span class="n">BMCV_INTER_NEAREST</span>
    <span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="convert-format">
<h2><span class="section-number">5.14.21. </span>convert_format<a class="headerlink" href="#convert-format" title="Link to this heading"></a></h2>
<p>Convert input to output format or convert an image to BGR PLANAR format.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage</p></li>
</ul>
<p>BMimage instance</p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>output image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">convert_format</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage</p></li>
</ul>
<p>BMimage instance</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>output image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">convert_format</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="n">sail</span><span class="o">.</span><span class="n">FORMAT_BGR_PLANAR</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="vpp-convert-format">
<h2><span class="section-number">5.14.22. </span>vpp_convert_format<a class="headerlink" href="#vpp-convert-format" title="Link to this heading"></a></h2>
<p>Convert input to output format or convert an image to BGR PLANAR format using vpp.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_convert_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage</p></li>
</ul>
<p>BMimage instance</p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>output image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_convert_format</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">vpp_convert_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage</p></li>
</ul>
<p>BMimage instance</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>output image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_convert_format</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span><span class="n">sail</span><span class="o">.</span><span class="n">FORMAT_BGR_PLANAR</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="puttext">
<h2><span class="section-number">5.14.23. </span>putText<a class="headerlink" href="#puttext" title="Link to this heading"></a></h2>
<p>Draws a text on the image.</p>
<p>Supported pixel format for input BMImage:
FORMAT_GRAY, FORMAT_YUV420P, FORMAT_YUV422P, FORMAT_YUV444P, FORMAT_NV12,
FORMAT_NV21, FORMAT_NV16, FORMAT_NV61</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">putText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
            <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="n">fontScale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>

<span class="k">def</span><span class="w"> </span><span class="nf">putText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="nb">input</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">bm_image</span><span class="p">,</span>
            <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="n">fontScale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage</p></li>
</ul>
<p>BMimage instance</p>
<ul class="simple">
<li><p>text: str</p></li>
</ul>
<p>Text to write on an image.</p>
<ul class="simple">
<li><p>x: int</p></li>
</ul>
<p>Start point x</p>
<ul class="simple">
<li><p>y: int</p></li>
</ul>
<p>Start point y</p>
<ul class="simple">
<li><p>color : tuple</p></li>
</ul>
<p>Color of text</p>
<ul class="simple">
<li><p>fontScale : float</p></li>
</ul>
<p>Size of font</p>
<ul class="simple">
<li><p>thickness : int</p></li>
</ul>
<p>Thickness of text</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>process_status : int</p></li>
</ul>
<p>0 for success and others for failure</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bgr_img</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">yuv_img</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">convert_format</span><span class="p">(</span><span class="n">bgr_img</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">FORMAT_YUV420P</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">yuv_img</span><span class="p">,</span> <span class="s2">&quot;some text&quot;</span> <span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="image-add-weighted">
<h2><span class="section-number">5.14.24. </span>image_add_weighted<a class="headerlink" href="#image-add-weighted" title="Link to this heading"></a></h2>
<p>Calculates the weighted sum of two images</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">image_add_weighted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">input0</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">input1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">output</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input0 : sail.BMImage</p></li>
</ul>
<p>BMimage instance.</p>
<ul class="simple">
<li><p>alpha : float</p></li>
</ul>
<p>alpha instance.</p>
<ul class="simple">
<li><p>input1 : sail.BMImage</p></li>
</ul>
<p>BMImage instance.</p>
<ul class="simple">
<li><p>beta: float</p></li>
</ul>
<p>beta instance.</p>
<ul class="simple">
<li><p>gamma: float</p></li>
</ul>
<p>gamma instance.</p>
<ul class="simple">
<li><p>output: BMImage</p></li>
</ul>
<p>result BMImage, output = input1 * alpha + input2 * beta + gamma.</p>
<dl>
<dt><strong>Sample1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name1</span> <span class="o">=</span> <span class="s2">&quot;your_image_path1&quot;</span>
    <span class="n">image_name2</span> <span class="o">=</span> <span class="s2">&quot;your_image_path2&quot;</span>
    <span class="n">decoder1</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name1</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">decoder2</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name2</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">decoder2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmg</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">image_add_weighted</span><span class="p">(</span><span class="n">BMimg1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">BMimg2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">bmg</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">image_add_weighted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">input0</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="n">input1</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
                        <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">BMImage</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input0 : sail.BMImage</p></li>
</ul>
<p>BMimage instance.</p>
<ul class="simple">
<li><p>alpha : float</p></li>
</ul>
<p>alpha instance.</p>
<ul class="simple">
<li><p>input1 : sail.BMImage</p></li>
</ul>
<p>BMImage instance.</p>
<ul class="simple">
<li><p>beta: float</p></li>
</ul>
<p>beta instance.</p>
<ul class="simple">
<li><p>gamma: float</p></li>
</ul>
<p>gamma instance.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output: BMImage</p></li>
</ul>
<p>result BMImage, output = input1 * alpha + input2 * beta + gamma.</p>
<dl>
<dt><strong>Sample2:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name1</span> <span class="o">=</span> <span class="s2">&quot;your_image_path1&quot;</span>
    <span class="n">image_name2</span> <span class="o">=</span> <span class="s2">&quot;your_image_path2&quot;</span>
    <span class="n">decoder1</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name1</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">decoder2</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name2</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">decoder2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmg</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">image_add_weighted</span><span class="p">(</span><span class="n">BMimg1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">BMimg2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="image-copy-to">
<h2><span class="section-number">5.14.25. </span>image_copy_to<a class="headerlink" href="#image-copy-to" title="Link to this heading"></a></h2>
<p>Copy the input to the output.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">image_copy_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="nb">input</span><span class="p">:</span> <span class="n">BMImage</span><span class="o">|</span><span class="n">BMImageArray</span><span class="p">,</span>
                <span class="n">output</span><span class="p">:</span> <span class="n">BMImage</span><span class="o">|</span><span class="n">BMImageArray</span><span class="p">,</span>
                <span class="n">start_x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">start_y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input: BMImage|BMImageArray</p></li>
</ul>
<p>Input image or image array.</p>
<ul class="simple">
<li><p>output: BMImage|BMImageArray</p></li>
</ul>
<p>Output image or image array.</p>
<ul class="simple">
<li><p>start_x: int</p></li>
</ul>
<p>Point start x.</p>
<ul class="simple">
<li><p>start_y: int</p></li>
</ul>
<p>Point start y.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name1</span> <span class="o">=</span> <span class="s2">&quot;your_image_path1&quot;</span>
    <span class="n">image_name2</span> <span class="o">=</span> <span class="s2">&quot;your_image_path2&quot;</span>
    <span class="n">decoder1</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name1</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">decoder2</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name2</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">decoder2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">image_copy_to</span><span class="p">(</span><span class="n">BMimg1</span><span class="p">,</span><span class="n">BMimg2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="image-copy-to-padding">
<h2><span class="section-number">5.14.26. </span>image_copy_to_padding<a class="headerlink" href="#image-copy-to-padding" title="Link to this heading"></a></h2>
<p>Copy the input to the output width padding.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">image_copy_to_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="nb">input</span><span class="p">:</span> <span class="n">BMImage</span><span class="o">|</span><span class="n">BMImageArray</span><span class="p">,</span>
                        <span class="n">output</span><span class="p">:</span> <span class="n">BMImage</span><span class="o">|</span><span class="n">BMImageArray</span><span class="p">,</span>
                        <span class="n">padding_r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">padding_g</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">padding_b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">start_x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">start_y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input: BMImage|BMImageArray</p></li>
</ul>
<p>Input image or image array.</p>
<ul class="simple">
<li><p>output: BMImage|BMImageArray</p></li>
</ul>
<p>Output image or image array.</p>
<ul class="simple">
<li><p>padding_r: int</p></li>
</ul>
<p>r value for padding.</p>
<ul class="simple">
<li><p>padding_g: int</p></li>
</ul>
<p>g value for padding.</p>
<ul class="simple">
<li><p>padding_b: int</p></li>
</ul>
<p>b value for padding.</p>
<ul class="simple">
<li><p>start_x: int</p></li>
</ul>
<p>point start x.</p>
<ul class="simple">
<li><p>start_y: int</p></li>
</ul>
<p>point start y.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name1</span> <span class="o">=</span> <span class="s2">&quot;your_image_path1&quot;</span>
    <span class="n">image_name2</span> <span class="o">=</span> <span class="s2">&quot;your_image_path2&quot;</span>
    <span class="n">decoder1</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name1</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">decoder2</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name2</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">decoder2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">image_copy_to_padding</span><span class="p">(</span><span class="n">BMimg1</span><span class="p">,</span><span class="n">BMimg2</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="nms">
<h2><span class="section-number">5.14.27. </span>nms<a class="headerlink" href="#nms" title="Link to this heading"></a></h2>
<p>Do nms use tpu.</p>
<p><strong>Note:</strong> For details about whether this operator in current SDK supports BM1688, check the page “BMCV API” in 《Multimedia User Guide》.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">nms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">]]</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input: [float, float, float, float, float]</p></li>
</ul>
<p>input proposal array, shape must be (self, n,5) n&lt;56000, proposal:[left,top,right,bottom,score].</p>
<ul class="simple">
<li><p>threshold: float</p></li>
</ul>
<p>nms threshold.</p>
<p><strong>Returns:</strong></p>
<p>return nms result, numpy.ndarray[Any, numpy.dtype[numpy.float32]]</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">input_boxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]</span>
    <span class="p">])</span>
    <span class="n">nms_threshold</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">selected_boxes</span>  <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">nms</span><span class="p">(</span><span class="n">input_boxes</span><span class="p">,</span> <span class="n">nms_threshold</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">selected_boxes</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="drawpoint">
<h2><span class="section-number">5.14.28. </span>drawPoint<a class="headerlink" href="#drawpoint" title="Link to this heading"></a></h2>
<p>Draw Point on input image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">drawPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span>
            <span class="n">center</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">color</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>

<span class="k">def</span><span class="w"> </span><span class="nf">drawPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">bm_image</span><span class="p">,</span>
            <span class="n">center</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">color</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>image: BMImage | bm_image</p></li>
</ul>
<p>Input image</p>
<ul class="simple">
<li><p>center: Tuple[int, int]</p></li>
</ul>
<p>center of point, (point_x, point_y)</p>
<ul class="simple">
<li><p>color: Tuple[int, int, int],</p></li>
</ul>
<p>color of drawn, (b,g,r)</p>
<ul class="simple">
<li><p>radius: int</p></li>
</ul>
<p>Radius of drawn</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">drawPoint</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="warp-perspective">
<h2><span class="section-number">5.14.29. </span>warp_perspective<a class="headerlink" href="#warp-perspective" title="Link to this heading"></a></h2>
<p>Applies a perspective transformation to an image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">warp_perspective</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span>
                    <span class="n">coordinate</span><span class="p">:</span> <span class="p">[[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]],</span>
                    <span class="n">output_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">output_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="n">bm_image_format_ext</span> <span class="o">=</span> <span class="n">FORMAT_BGR_PLANAR</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="p">:</span> <span class="n">bm_image_data_format_ext</span> <span class="o">=</span> <span class="n">DATA_TYPE_EXT_1N_BYTE</span><span class="p">,</span>
                    <span class="n">use_bilinear</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BMImage</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input: BMImage</p></li>
</ul>
<p>Input image</p>
<p>coordinate: [[int,int],[int,int],[int,int],[int,int]]</p>
<ul class="simple">
<li><dl class="simple">
<dt>Original coordinate, like(left_top.x, left_top.y), (right_top.x, right_top.y), </dt><dd><p>(left_bottom.x, left_bottom.y), (right_bottom.x, right_bottom.y)</p>
</dd>
</dl>
</li>
<li><p>output_width: int</p></li>
</ul>
<p>Output width</p>
<ul class="simple">
<li><p>output_height: int</p></li>
</ul>
<p>Output height</p>
<ul class="simple">
<li><p>format : bm_image_format_ext</p></li>
</ul>
<p>Output image format, Only FORMAT_BGR_PLANAR,FORMAT_RGB_PLANAR</p>
<ul class="simple">
<li><p>dtype: bm_image_data_format_ext</p></li>
</ul>
<p>Output image dtype, Only DATA_TYPE_EXT_1N_BYTE,DATA_TYPE_EXT_4N_BYTE</p>
<ul class="simple">
<li><p>use_bilinear: int</p></li>
</ul>
<p>Bilinear use flag.</p>
<p><strong>Returns:</strong></p>
<p>Output image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">warp_perspective</span><span class="p">(</span><span class="n">BMimg</span><span class="p">,</span> <span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">380</span><span class="p">),</span> <span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">380</span><span class="p">)),</span><span class="mi">640</span><span class="p">,</span><span class="mi">640</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="get-bm-data-type">
<h2><span class="section-number">5.14.30. </span>get_bm_data_type<a class="headerlink" href="#get-bm-data-type" title="Link to this heading"></a></h2>
<p>Convert bm_image_data_format_ext to bm_data_type_t</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_bm_data_type</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">ImgDtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">Dtype</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>format: sail.ImgDtype</p></li>
</ul>
<p>The type that needs to be converted.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: sail.Dtype</p></li>
</ul>
<p>The converted type.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">get_bm_data_type</span><span class="p">(</span><span class="n">sail</span><span class="o">.</span><span class="n">DATA_TYPE_EXT_FLOAT32</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="get-bm-image-data-format">
<h2><span class="section-number">5.14.31. </span>get_bm_image_data_format<a class="headerlink" href="#get-bm-image-data-format" title="Link to this heading"></a></h2>
<p>Convert bm_data_type_t to bm_image_data_format_ext</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_bm_image_data_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">bm_data_type_t</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bm_image_data_format_ext</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>dtype: sail.Dtype</p></li>
</ul>
<p>The sail.Dtype that needs to be converted.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: sail.ImgDtype</p></li>
</ul>
<p>The converted type.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">get_bm_image_data_format</span><span class="p">(</span><span class="n">sail</span><span class="o">.</span><span class="n">BM_FLOAT32</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="imdecode">
<h2><span class="section-number">5.14.32. </span>imdecode<a class="headerlink" href="#imdecode" title="Link to this heading"></a></h2>
<p>Load image from system memory</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">imdecode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BMImage</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>data_bytes: bytes</p></li>
</ul>
<p>image data bytes in system memory</p>
<p><strong>Returns:</strong></p>
<p>return decoded image</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_file</span><span class="p">:</span>
        <span class="n">image_data_bytes</span> <span class="o">=</span> <span class="n">image_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">src_img</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">image_data_bytes</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="imencode">
<h2><span class="section-number">5.14.33. </span>imencode<a class="headerlink" href="#imencode" title="Link to this heading"></a></h2>
<p>Encode an BMimage and return the encoded data.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">imencode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ext</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>ext: str</p></li>
</ul>
<p>Input parameter. Image encoding format, supported formats include <code class="docutils literal notranslate"><span class="pre">&quot;.jpg&quot;</span></code> , <code class="docutils literal notranslate"><span class="pre">&quot;.png&quot;</span></code> , etc.</p>
<ul class="simple">
<li><p>img: BMImage</p></li>
</ul>
<p>Input parameter. Input BMImage, only FORMAT_BGR_PACKED, DATA_TYPE_EXT_1N_BYTE pictures are supported.</p>
<p><strong>Return:</strong></p>
<ul class="simple">
<li><p>ret: numpy.array</p></li>
</ul>
<p>The data that is encoded and placed in system memory.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">imencode</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span><span class="n">BMimg</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="fft">
<h2><span class="section-number">5.14.34. </span>fft<a class="headerlink" href="#fft" title="Link to this heading"></a></h2>
<p>1d or 2d fft (only real part, or real part and imaginary part)</p>
<p><strong>Note:</strong> For details about whether this operator in current SDK supports BM1688, check the page “BMCV API” in 《Multimedia User Guide》.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forward</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">input_real</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>forward: bool</p></li>
</ul>
<p>positive transfer</p>
<ul class="simple">
<li><p>input_real: Tensor</p></li>
</ul>
<p>input tensor</p>
<p><strong>Returns:</strong></p>
<p>return list[Tensor], The real and imaginary part of output</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">forward</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">input_real</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
        <span class="n">input_imag</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>forward: bool</p></li>
</ul>
<p>positive transfer</p>
<ul class="simple">
<li><p>input_real: Tensor</p></li>
</ul>
<p>input tensor real part</p>
<ul class="simple">
<li><p>input_imag: Tensor</p></li>
</ul>
<p>input tensor imaginary part</p>
<p>Returns:</p>
<p>return list[Tensor], The real and imaginary part of output</p>
</section>
<section id="mat-to-bm-image">
<h2><span class="section-number">5.14.35. </span>mat_to_bm_image<a class="headerlink" href="#mat-to-bm-image" title="Link to this heading"></a></h2>
<p>transform opencv mat to sail BMImage.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mat_to_bm_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mat</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">BMImage</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>mat : numpy</p></li>
</ul>
<p>input opencv mat.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: sail.BMImage</p></li>
</ul>
<p>return sail.BMImage.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">opencv_mat</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
    <span class="n">sail_bm_image</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">mat_to_bm_image</span><span class="p">(</span><span class="n">opencv_mat</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mat_to_bm_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mat</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">img</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>mat : numpy</p></li>
</ul>
<p>input opencv mat.</p>
<ul class="simple">
<li><p>img : sail.BMImage</p></li>
</ul>
<p>output sail.BMImage.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: int</p></li>
</ul>
<p>returns 0 if success.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">opencv_mat</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
    <span class="n">BMimg2</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">mat_to_bm_image</span><span class="p">(</span><span class="n">opencv_mat</span><span class="p">,</span><span class="n">BMimg2</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="polylines">
<h2><span class="section-number">5.14.36. </span>polylines<a class="headerlink" href="#polylines" title="Link to this heading"></a></h2>
<p>It can be realized to draw one or more line segments on an image,
so that the function of drawing polygons can be realized, and the color and width of the line can be specified.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">polylines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)]],</span> <span class="n">isClosed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>img : sail.BMImage</p></li>
</ul>
<p>Input BMImage.</p>
<ul class="simple">
<li><p>pts : list[list[tuple(int, int)]]</p></li>
</ul>
<p>The starting point and end point coordinates of the line segment, multiple coordinate points can be entered. The upper left corner of the image is the origin,
extending to the right in the x direction and extending down in the y direction.</p>
<ul class="simple">
<li><p>isClosed : bool</p></li>
</ul>
<p>Whether the graph is closed.</p>
<ul class="simple">
<li><p>color : tuple(int, int, int)</p></li>
</ul>
<p>The color of the line is the value of the three RGB channels.</p>
<ul class="simple">
<li><p>thickness : int</p></li>
</ul>
<p>The width of the lines is recommended to be even for YUV format images.</p>
<ul class="simple">
<li><p>shift : int</p></li>
</ul>
<p>Polygon scaling multiple. Default is not scaling. The scaling factor is(1/2)^shift。</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: int</p></li>
</ul>
<p>returns 0 if success.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_convert_format</span><span class="p">(</span><span class="n">BMimg1</span><span class="p">,</span><span class="n">sail</span><span class="o">.</span><span class="n">FORMAT_YUV444P</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">bm</span><span class="p">,[[(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="mi">40</span><span class="p">,</span><span class="mi">80</span><span class="p">)]],</span><span class="kc">True</span><span class="p">,[</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">])</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="mosaic">
<h2><span class="section-number">5.14.37. </span>mosaic<a class="headerlink" href="#mosaic" title="Link to this heading"></a></h2>
<p>This interface is used to print one or more mosaics on an image.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mosaic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mosaic_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">rects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]],</span> <span class="n">is_expand</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>mosaic_num : int</p></li>
</ul>
<p>Number of mosaics, length of list in rects.</p>
<ul class="simple">
<li><p>img : sail.BMImage</p></li>
</ul>
<p>Input BMImage.</p>
<ul class="simple">
<li><p>rects : list[list[int,int,int,int]]</p></li>
</ul>
<p>Multiple Mosaic positions, the parameters in each element in the list are
[Mosaic at X-axis start point, Mosaic at Y-axis start point, Mosaic width, Mosaic height].</p>
<ul class="simple">
<li><p>is_expand : int</p></li>
</ul>
<p>Whether to expand the column.
A value of 0 means that the column is not expanded,
and a value of 1 means that a macro block (8 pixels) is expanded around the original Mosaic.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: int</p></li>
</ul>
<p>returns 0 if success.</p>
<p><strong>Sample:</strong></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">mosaic</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">BMimg1</span><span class="p">,</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">2000</span><span class="p">],[</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">100</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="gaussian-blur">
<h2><span class="section-number">5.14.38. </span>gaussian_blur<a class="headerlink" href="#gaussian-blur" title="Link to this heading"></a></h2>
<p>This interface is used for image Gaussian filtering.
<strong>Note: The previous SDK does not support BM1684X.
For details about whether the current SDK supports BM1684X, check the page “BMCV API” in《Multimedia User Guide》. *</strong></p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">gaussian_blur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">kh</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sigmaX</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sigmaY</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BMImage</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>input : sail.BMImage</p></li>
</ul>
<p>Input BMImage.</p>
<ul class="simple">
<li><p>kw : int</p></li>
</ul>
<p>The size of kernel in the width direction.</p>
<ul class="simple">
<li><p>kh : int</p></li>
</ul>
<p>The size of kernel in the height direction.</p>
<ul class="simple">
<li><p>sigmaX : float</p></li>
</ul>
<p>Gaussian kernel standard deviation in the X direction.</p>
<ul class="simple">
<li><p>sigmaY : float</p></li>
</ul>
<p>Gaussian kernel standard deviation in the Y direction.Default is 0,
which means that it is the same standard deviation as the Gaussian kernel in the X direction.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>output : sail.BMImage</p></li>
</ul>
<p>Returns a Gaussian filtered image.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>


    <span class="n">bmimg</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="s2">&quot;your_img.jpg&quot;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bmimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">bmimg</span><span class="o">.</span><span class="n">format</span><span class="p">())</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">gaussian_blur</span><span class="p">(</span><span class="n">bmimg</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="n">bmcv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;out.jpg&quot;</span><span class="p">,</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="transpose">
<h2><span class="section-number">5.14.39. </span>transpose<a class="headerlink" href="#transpose" title="Link to this heading"></a></h2>
<p>The interface can realize the transposition of image width and height.</p>
<dl>
<dt><strong>Interface1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters1:</strong></p>
<ul class="simple">
<li><p>src : sail.BMImage</p></li>
</ul>
<p>Input BMImage.</p>
<p><strong>Returns2:</strong></p>
<ul class="simple">
<li><p>output: sail.BMImage:</p></li>
</ul>
<p>output sail.BMImage.</p>
<dl>
<dt><strong>Interface2:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters2:</strong></p>
<ul class="simple">
<li><p>src : sail.BMImage</p></li>
</ul>
<p>Input BMImage.</p>
<ul class="simple">
<li><p>dst : sail.BMImage</p></li>
</ul>
<p>output sail.BMImage.</p>
<p><strong>Returns2:</strong></p>
<ul class="simple">
<li><p>ret : int</p></li>
</ul>
<p>returns 0 if success.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmimg</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="s2">&quot;your_img.jpg&quot;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bmimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">convert_format</span><span class="p">(</span><span class="n">bmimg</span><span class="p">,</span><span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_GRAY</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;readed&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">format</span><span class="p">())</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="n">bmcv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;out.jpg&quot;</span><span class="p">,</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="watermark-superpose">
<h2><span class="section-number">5.14.40. </span>watermark_superpose<a class="headerlink" href="#watermark-superpose" title="Link to this heading"></a></h2>
<p>Implement adding multiple watermarks to images</p>
<dl>
<dt><strong>接口形式:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">watermark_superpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<span class="n">image</span><span class="p">:</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">,</span>
<span class="n">water_name</span><span class="p">:</span><span class="n">string</span><span class="p">,</span>
<span class="n">bitmap_type</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="n">pitch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="n">rects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span>
        <span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>参数说明:</strong></p>
<ul class="simple">
<li><p>Image: save BMImage</p></li>
</ul>
<p>Input image</p>
<ul class="simple">
<li><p>Watername: string</p></li>
</ul>
<p>Watermark file path</p>
<ul class="simple">
<li><p>Bitmap_type: int</p></li>
</ul>
<p>Input parameters. Watermark type, a value of 0 indicates that the watermark is an 8-bit data type (with transparency information), and a value of 1 indicates that the watermark is a 1-bit data type (without transparency information).</p>
<ul class="simple">
<li><p>Pitch: int</p></li>
</ul>
<p>Input parameters. The number of bytes per line in a watermark file can be understood as the width of the watermark.</p>
<ul class="simple">
<li><p>Rects: list</p></li>
</ul>
<p>Input parameters. Watermark position, including the starting point and width/height of each watermark.</p>
<ul class="simple">
<li><p>Color: tuple</p></li>
</ul>
<p>Input parameters. The color of the watermark.</p>
<p><strong>Return value description:</strong></p>
<ul class="simple">
<li><p>Ret: int</p></li>
</ul>
<p>Whether the return was successful</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path1&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">water_name</span> <span class="o">=</span> <span class="s1">&#39;your_watermark_path&#39;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">watermark_superpose</span><span class="p">(</span><span class="n">BMimg1</span><span class="p">,</span><span class="n">water_name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">117</span><span class="p">,[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">117</span><span class="p">,</span><span class="mi">79</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">117</span><span class="p">,</span><span class="mi">79</span><span class="p">]],[</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">])</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;aafaa.jpg&quot;</span><span class="p">,</span><span class="n">BMimg1</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="sobel">
<h2><span class="section-number">5.14.41. </span>Sobel<a class="headerlink" href="#sobel" title="Link to this heading"></a></h2>
<p>Soble operator for edge detection.</p>
<p><strong>Note:</strong> For details about whether this operator in current SDK supports BM1684X/BM1688, check the page “BMCV API” in 《Multimedia User Guide》.</p>
<dl>
<dt><strong>Interface1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Sobel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters1:</strong></p>
<ul class="simple">
<li><p>input</p></li>
</ul>
<p>Input BMImage</p>
<ul class="simple">
<li><p>output</p></li>
</ul>
<p>Output BMImage</p>
<ul class="simple">
<li><p>dx</p></li>
</ul>
<p>Order of the derivative x.</p>
<ul class="simple">
<li><p>dy</p></li>
</ul>
<p>Order of the derivative y</p>
<ul class="simple">
<li><p>ksize</p></li>
</ul>
<p>ize of the extended Sobel kernel; it must be -1, 1, 3, 5, or 7. -1 means 3x3 Scharr filter will be used.</p>
<ul class="simple">
<li><p>scale</p></li>
</ul>
<p>Optional scale factor for the computed derivative values; by default, no scaling is applied</p>
<ul class="simple">
<li><p>delta</p></li>
</ul>
<p>Optional delta value that is added to the results prior to storing them in dst.</p>
<p><strong>Returns1:</strong></p>
<ul class="simple">
<li><p>ret: int</p></li>
</ul>
<p>returns 0 if success.</p>
<dl>
<dt><strong>Interface2:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Sobel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ksize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BMImage</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters2:</strong></p>
<ul class="simple">
<li><p>input</p></li>
</ul>
<p>Input BMImage</p>
<ul class="simple">
<li><p>dx</p></li>
</ul>
<p>Order of the derivative x.</p>
<ul class="simple">
<li><p>dy</p></li>
</ul>
<p>Order of the derivative y</p>
<ul class="simple">
<li><p>ksize</p></li>
</ul>
<p>ize of the extended Sobel kernel; it must be -1, 1, 3, 5, or 7. -1 means 3x3 Scharr filter will be used.</p>
<ul class="simple">
<li><p>scale</p></li>
</ul>
<p>Optional scale factor for the computed derivative values; by default, no scaling is applied</p>
<ul class="simple">
<li><p>delta</p></li>
</ul>
<p>Optional delta value that is added to the results prior to storing them in dst.</p>
<p><strong>Returns2:</strong></p>
<ul class="simple">
<li><p>output: BMImage</p></li>
</ul>
<p>returns porcessed BMImage.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">bmimg</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">()</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="s2">&quot;your_img.jpg&quot;</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bmimg</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">bmimg</span><span class="o">.</span><span class="n">format</span><span class="p">())</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">bmimg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bmcv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;out.jpg&quot;</span><span class="p">,</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="drawlines">
<h2><span class="section-number">5.14.42. </span>drawLines<a class="headerlink" href="#drawlines" title="Link to this heading"></a></h2>
<p>Draws multiple lines on a given image.</p>
<p><strong>Note:</strong> For details about whether this operator in current SDK supports BM1684X, check the page “BMCV API” in 《Multimedia User Guide》.</p>
<dl>
<dt><strong>Interface1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">drawLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">start_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">end_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">line_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>image : sail.BMImage</p></li>
</ul>
<p>Input image.</p>
<ul class="simple">
<li><p>start_points : list[tuple[int, int]]</p></li>
</ul>
<p>A list of starting point coordinates for the line segments, with the top-left corner of the image as the origin, extending to the right for the x-direction and down for the y-direction.</p>
<ul class="simple">
<li><p>end_points : list[tuple[int, int]]</p></li>
</ul>
<p>A List of ending point coordinates for the lines, which must have the same length as the list of starting points.</p>
<ul class="simple">
<li><p>line_num : int</p></li>
</ul>
<p>The number of line segments, which must be the same as the length of the starting and ending points lists.</p>
<ul class="simple">
<li><p>color : tuple[int, int, int]</p></li>
</ul>
<p>The color of the line segments, in RGB format.</p>
<ul class="simple">
<li><p>thickness : int</p></li>
</ul>
<p>The thickness of the line segments.</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: int</p></li>
</ul>
<p>Returns 0 upon success.</p>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;your_image_path&quot;</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">BMimg1</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="c1"># here is a sail.BMImage</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">start_points</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)]</span>
    <span class="n">end_points</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)]</span>
    <span class="n">line_num</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">thickness</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">vpp_convert_format</span><span class="p">(</span><span class="n">BMimg1</span><span class="p">,</span><span class="n">sail</span><span class="o">.</span><span class="n">FORMAT_YUV444P</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">drawLines</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">start_points</span><span class="p">,</span> <span class="n">end_points</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="stft">
<h2><span class="section-number">5.14.43. </span>stft<a class="headerlink" href="#stft" title="Link to this heading"></a></h2>
<p>Short-Time Fourier Transform(STFT)</p>
<p><strong>Note:</strong> For details about whether this operator in current SDK supports BM1684X, check the page “BMCV API” in 《Multimedia User Guide》.</p>
<dl>
<dt><strong>Interface1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_real</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">input_imag</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">real_input</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hop_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">pad_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">win_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>

<span class="n">stft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_real</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">input_imag</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">real_input</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hop_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">pad_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">win_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>input_real: numpy.ndarray or Tensor</dt><dd><p>The real part of the input signal.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>input_imag: numpy.ndarray or Tensor</dt><dd><p>The imaginary part of the input signal.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>real_input: bool</dt><dd><p>A flag indicating whether to use only real input.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>normalize: bool</dt><dd><p>A flag indicating whether to normalize the output.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>n_fft: int</dt><dd><p>The number of FFT points used in the STFT computation.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hop_len: int</dt><dd><p>The step size for sliding the window.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>pad_mode: int</dt><dd><p>The padding mode for the input signal. 0 indicates CONSTANT padding, and 1 indicates REFLECT padding.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>win_mode: int</dt><dd><p>The type of window function. 0 represents the HANN window, and 1 represents the HAMM window.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>result: tuple[numpy.ndarray, numpy.ndarray]</dt><dd><p>Returns the real part and imaginary part of the output.</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">random_array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">random_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">input_real</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">random_array1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">input_imag</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">random_array2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">real_input</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">n_fft</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">hop_len</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">pad_mode</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">win_mode</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">stft_R</span><span class="p">,</span> <span class="n">stft_I</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">input_real</span><span class="p">,</span> <span class="n">input_imag</span><span class="p">,</span> <span class="n">real_input</span><span class="p">,</span> <span class="n">normalize</span><span class="p">,</span> <span class="n">n_fft</span><span class="p">,</span> <span class="n">hop_len</span><span class="p">,</span> <span class="n">pad_mode</span><span class="p">,</span> <span class="n">win_mode</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="istft">
<h2><span class="section-number">5.14.44. </span>istft<a class="headerlink" href="#istft" title="Link to this heading"></a></h2>
<p>Inverse Short-Time Fourier Transform(ISTFT)</p>
<p><strong>Note:</strong> For details about whether this operator in current SDK supports BM1684X, check the page “BMCV API” in 《Multimedia User Guide》.</p>
<dl>
<dt><strong>Interface1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">istft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_real</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">input_imag</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">real_input</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">L</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hop_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">pad_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">win_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="n">istft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_real</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">input_imag</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">real_input</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">L</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hop_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">pad_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">win_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>input_real: numpy.ndarray or Tensor</dt><dd><p>The real part of the input signal.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>input_imag: numpy.ndarray or Tensor</dt><dd><p>The imaginary part of the input signal.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>real_input: bool</dt><dd><p>Indicates whether the output signal is real; false for complex, true for real.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>normalize: bool</dt><dd><p>Whether to normalize the output.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>L: int</dt><dd><p>The length of the original time-domain signal.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hop_len: int</dt><dd><p>The step size for sliding the window; must match the value used during STFT computation.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>pad_mode: int</dt><dd><p>The padding mode for the input signal; must match the value used during STFT computation.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>win_mode: int</dt><dd><p>The type of window function; must match the value used during STFT computation.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>result: tuple[numpy.ndarray, numpy.ndarray]</dt><dd><p>Returns the real part and imaginary part of the output.</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">random_array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">513</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">random_array2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">513</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">input_real</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">random_array1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">input_imag</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">random_array2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">real_input</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="n">hop_len</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">pad_mode</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">win_mode</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">istft_R</span><span class="p">,</span> <span class="n">istft_I</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">istft</span><span class="p">(</span><span class="n">input_real</span><span class="p">,</span> <span class="n">input_imag</span><span class="p">,</span> <span class="n">real_input</span><span class="p">,</span> <span class="n">normalize</span><span class="p">,</span> <span class="mi">4096</span><span class="p">,</span> <span class="n">hop_len</span><span class="p">,</span> <span class="n">pad_mode</span><span class="p">,</span> <span class="n">win_mode</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="bmcv-overlay">
<h2><span class="section-number">5.14.45. </span>bmcv_overlay<a class="headerlink" href="#bmcv-overlay" title="Link to this heading"></a></h2>
<p>Add a watermark with a transparent channel to the image. Only support BM1688, CV186AH。</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bmcv_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">BMImage</span><span class="p">,</span> <span class="n">overlay_info</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">overlay_image</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BMImage</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>image : sail.BMImage</p></li>
</ul>
<p>input/output image</p>
<ul class="simple">
<li><p>overlay_info: list[list[int]]</p></li>
</ul>
<p>The position and size information of a set of watermarks in the format of [x,y,w,h]</p>
<ul class="simple">
<li><p>overlay_image: list[BMImage]</p></li>
</ul>
<p>A group of watermark, only support sail.Format.FORMAT_ARGB_PACKED</p>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p>ret: int</p></li>
</ul>
<p>0 for success</p>
<p><strong>Note：</strong></p>
<p>You need to make sure that all rectangles in overlay_info do not overlap</p>
<p><strong>Sample1:</strong></p>
<p>Read RGBA images directly as watermarks</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="s2">&quot;pics/1.jpg&quot;</span><span class="p">)</span>
    <span class="n">image_org</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="n">buffer</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;pics/icon.png&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>
    <span class="n">buffer_x</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">buffer_y</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">buffer_w</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">buffer_h</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="n">buffer_x1</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">buffer_y1</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">buffer_w1</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">buffer_h1</span> <span class="o">=</span> <span class="mi">70</span>

    <span class="n">buffer</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="p">(</span><span class="n">buffer_w</span><span class="p">,</span> <span class="n">buffer_h</span><span class="p">))</span>
    <span class="n">buffer1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="p">(</span><span class="n">buffer_w1</span><span class="p">,</span> <span class="n">buffer_h1</span><span class="p">))</span>

    <span class="n">overlay_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">overlay_info</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">overlay_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">buffer_h</span><span class="p">,</span> <span class="n">buffer_w</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_ARGB_PACKED</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">ImgDtype</span><span class="o">.</span><span class="n">DATA_TYPE_EXT_1N_BYTE</span><span class="p">))</span>
    <span class="n">overlay_info</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">buffer_x</span><span class="p">,</span><span class="n">buffer_y</span><span class="p">,</span><span class="n">buffer_w</span><span class="p">,</span> <span class="n">buffer_h</span><span class="p">])</span>
    <span class="n">overlay_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">buffer1</span><span class="p">,</span> <span class="n">buffer_h1</span><span class="p">,</span> <span class="n">buffer_w1</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_ARGB_PACKED</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">ImgDtype</span><span class="o">.</span><span class="n">DATA_TYPE_EXT_1N_BYTE</span><span class="p">))</span>
    <span class="n">overlay_info</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">buffer_x1</span><span class="p">,</span><span class="n">buffer_y1</span><span class="p">,</span><span class="n">buffer_w1</span><span class="p">,</span> <span class="n">buffer_h1</span><span class="p">])</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">bmcv_overlay</span><span class="p">(</span><span class="n">image_org</span><span class="p">,</span> <span class="n">overlay_info</span><span class="p">,</span> <span class="n">overlay_images</span><span class="p">)</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;overlayed.jpg&quot;</span><span class="p">,</span> <span class="n">image_org</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Sample2:</strong></p>
<p>Use other libraries to generate the watermark of Chinese text, and use overlay to draw in the designated position to realize the puttext function indirectly</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># get original image</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="s2">&quot;pics/1.jpg&quot;</span><span class="p">)</span>
    <span class="n">org_image</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="c1"># the info of font</span>
    <span class="n">watermark_w</span><span class="p">,</span> <span class="n">watermark_h</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">30</span>
    <span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;人&quot;</span><span class="p">,</span> <span class="s2">&quot;车&quot;</span><span class="p">,</span> <span class="s2">&quot;狗&quot;</span><span class="p">]</span>
    <span class="n">text_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="s2">&quot;fonts/simhei.ttf&quot;</span><span class="p">,</span> <span class="n">watermark_h</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

    <span class="c1"># get watermark of labels</span>
    <span class="n">overlay_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)):</span>
        <span class="n">blank_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">watermark_w</span><span class="p">,</span> <span class="n">watermark_h</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">blank_image</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="c1"># blank_image.save(&quot;watermark.png&quot;)</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">blank_image</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="n">overlay_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sail</span><span class="o">.</span><span class="n">BMImage</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">watermark_h</span><span class="p">,</span> <span class="n">watermark_w</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">Format</span><span class="o">.</span><span class="n">FORMAT_ARGB_PACKED</span><span class="p">,</span> <span class="n">sail</span><span class="o">.</span><span class="n">ImgDtype</span><span class="o">.</span><span class="n">DATA_TYPE_EXT_1N_BYTE</span><span class="p">))</span>

    <span class="c1"># after inference and other procedure</span>
    <span class="c1"># the position of the watermark map obtained by simulation</span>
    <span class="n">overlay_info</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">org_image</span><span class="o">.</span><span class="n">width</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">org_image</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">overlay_info</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">watermark_w</span><span class="p">,</span> <span class="n">watermark_h</span><span class="p">])</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">bmcv_overlay</span><span class="p">(</span><span class="n">org_image</span><span class="p">,</span> <span class="n">overlay_info</span><span class="p">,</span> <span class="n">overlay_images</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s2">&quot;overlayed.jpg&quot;</span><span class="p">,</span> <span class="n">org_image</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="faiss-indexflatl2">
<h2><span class="section-number">5.14.46. </span>faiss_indexflatL2<a class="headerlink" href="#faiss-indexflatl2" title="Link to this heading"></a></h2>
<p>Calculate squared L2 distance between query vectors and database vectors, output the top topK L2sqr-values and the corresponding indices.</p>
<dl>
<dt><strong>Interface1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">faiss_indexflatL2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">query_vecs_L2norm</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">database_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">database_vecs_L2norm</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="n">faiss_indexflatL2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">query_vecs_L2norm</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">database_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">database_vecs_L2norm</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
                <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>query_vecs: numpy.ndarray</dt><dd><p>The query vectors, the supported data type is only numpy.float32.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>query_vecs_L2norm: numpy.ndarray</dt><dd><p>Calculates the sum of the square values of the elements in each row of the query vector, numpy.float32.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>database_vecs: numpy.ndarray or Tensor</dt><dd><p>The database vectors, the supported data type is only numpy.float32 or sail.Dtype.BM_FLOAT32.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>database_vecs_L2norm: numpy.ndarray or Tensor</dt><dd><p>Calculates the sum of the square values of the elements in each row of the database vector, numpy.float32 or sail.Dtype.BM_FLOAT32.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>vec_dims: int</dt><dd><p>The dimension of the query vectors and database vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>query_vecs_nums: int</dt><dd><p>The numbers of the query vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>database_vecs_nums: int</dt><dd><p>The numbers of the database vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>topK: int</dt><dd><p>Get top topK values.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>result: tuple[numpy.ndarray, numpy.ndarray]</dt><dd><p>Returns the square value of the top topK best-matched L2 distance and its corresponding index.</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt><strong>Sample1:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 1. database_vecs</span>
    <span class="n">db_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">],</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># 2. query_vecs</span>
    <span class="n">query_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>

    <span class="c1"># 3. test bmcv.faiss_indexflatL2</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="n">db_vecs_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">db_vecs</span><span class="p">)</span>
    <span class="n">db_vecs_l2norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">db_vecs_square</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;db_vecs_l2norm:&quot;</span><span class="p">,</span> <span class="n">db_vecs_l2norm</span><span class="p">)</span>

    <span class="n">query_vecs_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">query_vecs</span><span class="p">)</span>
    <span class="n">query_vecs_l2norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">query_vecs_square</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;query_vecs_l2norm:&quot;</span><span class="p">,</span> <span class="n">query_vecs_l2norm</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">similarity_L2</span><span class="p">,</span> <span class="n">index_L2</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">faiss_indexflatL2</span><span class="p">(</span><span class="n">query_vecs</span><span class="p">,</span> <span class="n">query_vecs_l2norm</span><span class="p">,</span> <span class="n">db_vecs</span><span class="p">,</span> <span class="n">db_vecs_l2norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">execution_time_milliseconds_L2</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution time: </span><span class="si">{</span><span class="n">execution_time_milliseconds_L2</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;similarity_L2:&quot;</span><span class="p">,</span> <span class="n">similarity_L2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index_L2:&quot;</span><span class="p">,</span> <span class="n">index_L2</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Sample2:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 1. database_vecs</span>
    <span class="n">db_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">],</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># 2. query_vecs</span>
    <span class="n">query_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>

    <span class="c1"># 3. test bmcv.faiss_indexflatL2</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="n">db_vecs_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">db_vecs</span><span class="p">)</span>
    <span class="n">db_vecs_l2norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">db_vecs_square</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;db_vecs_l2norm:&quot;</span><span class="p">,</span> <span class="n">db_vecs_l2norm</span><span class="p">)</span>

    <span class="n">query_vecs_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">query_vecs</span><span class="p">)</span>
    <span class="n">query_vecs_l2norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">query_vecs_square</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;query_vecs_l2norm:&quot;</span><span class="p">,</span> <span class="n">query_vecs_l2norm</span><span class="p">)</span>

    <span class="c1"># 4. database_vecs and db_vecs_l2norm to sail::Tensor</span>
    <span class="n">db_tensor</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">db_vecs</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">db_tensor_l2norm</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">db_vecs_l2norm</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">similarity_L2</span><span class="p">,</span> <span class="n">index_L2</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">faiss_indexflatL2</span><span class="p">(</span><span class="n">query_vecs</span><span class="p">,</span> <span class="n">query_vecs_l2norm</span><span class="p">,</span> <span class="n">db_tensor</span><span class="p">,</span> <span class="n">db_tensor_l2norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">execution_time_milliseconds_L2</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution time: </span><span class="si">{</span><span class="n">execution_time_milliseconds_L2</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;similarity_L2:&quot;</span><span class="p">,</span> <span class="n">similarity_L2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index_L2:&quot;</span><span class="p">,</span> <span class="n">index_L2</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="faiss-indexflatip">
<h2><span class="section-number">5.14.47. </span>faiss_indexflatIP<a class="headerlink" href="#faiss-indexflatip" title="Link to this heading"></a></h2>
<p>Calculate inner product distance between query vectors and database vectors, output the top K IP-values and the corresponding indices.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">faiss_indexflatIP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">database_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="n">faiss_indexflatIP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">database_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
                <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_nums</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>query_vecs: numpy.ndarray</dt><dd><p>The query vectors, the supported data type is only numpy.float32.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>database_vecs: numpy.ndarray or Tensor</dt><dd><p>The database vectors, the supported data type is only numpy.float32 or sail.Dtype.BM_FLOAT32.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>vec_dims: int</dt><dd><p>The dimension of the query vectors and database vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>query_vecs_nums: int</dt><dd><p>The numbers of the query vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>database_vecs_nums: int</dt><dd><p>The numbers of the database vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>topK: int</dt><dd><p>Get top topK values.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>result: tuple[numpy.ndarray, numpy.ndarray]</dt><dd><p>Returns the top topK best-matched inner product distance values and their corresponding indexes.</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 1. database_vecs</span>
    <span class="n">db_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">],</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># 2. query_vecs</span>
    <span class="n">query_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>

    <span class="c1"># 3. test bmcv.faiss_indexflatIP</span>
    <span class="n">tpu_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">tpu_id</span><span class="p">)</span>
    <span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="n">db_tensor</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">db_vecs</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">similarity_IP</span><span class="p">,</span> <span class="n">index_IP</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">faiss_indexflatIP</span><span class="p">(</span><span class="n">query_vecs</span><span class="p">,</span> <span class="n">db_tensor</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="c1"># similarity_IP, index_IP = bmcv.faiss_indexflatIP(query_vecs, db_vecs, 3, 1, 5, 3)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">execution_time_milliseconds_L2</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution time: </span><span class="si">{</span><span class="n">execution_time_milliseconds_L2</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;similarity_IP:&quot;</span><span class="p">,</span> <span class="n">similarity_IP</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index_IP:&quot;</span><span class="p">,</span> <span class="n">index_IP</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="faiss-indexpq-encode">
<h2><span class="section-number">5.14.48. </span>faiss_indexPQ_encode<a class="headerlink" href="#faiss-indexpq-encode" title="Link to this heading"></a></h2>
<p>Perform PQ quantization encoding on the input vector and output the encoded vector.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">faiss_indexPQ_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
                <span class="n">encode_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IP_metric</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>

<span class="n">faiss_indexPQ_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                <span class="n">encode_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IP_metric</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="n">faiss_indexPQ_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">encoded_vecs</span><span class="p">:</span> <span class="n">Tensor</span>
                <span class="n">encode_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IP_metric</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>input_vecs: numpy.ndarray or Tensor</dt><dd><p>Input vector to be encoded, data types are supported only numpy.float32 or sail.Dtype.BM_FLOAT32, encode_vecs_num * vec_dims.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>centroids_vecs: numpy.ndarray or Tensor</dt><dd><p>centroids vector,  data types are supported only numpy.float32 or sail.Dtype.BM_FLOAT32, slice_num * centroids_num * (vec_dims / slice_num).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>encode_vecs_num: int</dt><dd><p>The number of vectors to be encoded.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>vec_dims: int</dt><dd><p>Dimension of the vector to be encoded.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>slice_num: int</dt><dd><p>The number of slices of the original vector dimensions, for example the original vector dimension is 512, slice_num = 8, and each subvector dimension is 64.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>centroids_num: int</dt><dd><p>The number of centroids.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>IP_metric: int</dt><dd><p>0 indicates that the distance is calculated using L2, and 1 indicates that the distance is calculated using IP.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>result: numpy.ndarray or Tensor</dt><dd><p>Output the encoded vector, numpy.ndarray (uint8) or Tensor (BM_UINT8).</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">faiss</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="n">encode_vecs_num</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">vec_dims</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">db_vecs_num</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">slice_num</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">centroids_num</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">nbits</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">666</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">db_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">pq</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">ProductQuantizer</span><span class="p">(</span><span class="n">vec_dims</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">,</span> <span class="n">nbits</span><span class="p">)</span>
<span class="n">pq</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># get centroids</span>
<span class="n">centroids</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">vector_float_to_array</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">centroids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;centroids.shape: &#39;</span><span class="p">,</span> <span class="n">centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;pq_centroids_random.npy&#39;</span><span class="p">,</span> <span class="n">centroids</span><span class="p">)</span>

<span class="c1"># faiss PQ encode</span>
<span class="n">input_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">encode_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">faiss_PQ_encode</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">compute_codes</span><span class="p">(</span><span class="n">input_vector</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;faiss_PQ_encode:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">faiss_PQ_encode</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;faiss_PQ_encode shape:&#39;</span><span class="p">,</span> <span class="n">faiss_PQ_encode</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># test sail bmcv.faiss_indexPQ_encode</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

<span class="n">centroids_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;pq_centroids_random.npy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;centroids_vecs shape:&quot;</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;centroids_vecs dtype:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">centroids_vecs</span><span class="p">))</span>

<span class="n">input_tensor</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">input_vector</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">centroids_tensor</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">encode_tensor</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">faiss_indexPQ_encode</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">centroids_tensor</span><span class="p">,</span> <span class="n">encode_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bmcv_faiss_indexPQ_encode:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">encode_tensor</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>

<span class="n">encode</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">faiss_indexPQ_encode</span><span class="p">(</span><span class="n">input_vector</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">,</span> <span class="n">encode_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bmcv_faiss_indexPQ_encode:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">encode</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="faiss-indexpq-adc">
<h2><span class="section-number">5.14.49. </span>faiss_indexPQ_ADC<a class="headerlink" href="#faiss-indexpq-adc" title="Link to this heading"></a></h2>
<p>The distance table is calculated by the query vector and the clustering center (centroid) vector, and the encoded database vector searches the table to calculate the distance and sorts it, output the topK distances and the corresponding indices.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">faiss_indexPQ_ADC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxquery_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IP_metric</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="n">faiss_indexPQ_ADC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxquery_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
                <span class="n">vec_dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IP_metric</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>nxquery_vecs: numpy.ndarray</dt><dd><p>query vectors, data types are supported only numpy.float32, and the size is query_vecs_nums * vec_dims.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>centroids_vecs: numpy.ndarray or Tensor</dt><dd><p>centroids vectors, data types are supported only numpy.float32 or sail.Dtype.BM_FLOAT32, and the size is slice_num * centroids_num * (vec_dims / slice_num).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>nycodes_vecs: numpy.ndarray or Tensor</dt><dd><p>Encoded database vector, data types are supported only numpy.uint8 or sail.Dtype.BM_UINT8, and the size is database_vecs_nums * slice_num.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>vec_dims: int</dt><dd><p>dimension of the query vector.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>slice_num: int</dt><dd><p>The number of slices of the original vector dimensions, for example the original vector dimension is 512, slice_num = 8, and each subvector dimension is 64.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>centroids_num: int</dt><dd><p>The number of centroids.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>database_vecs_nums: int</dt><dd><p>The number of database vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>query_vecs_nums: int</dt><dd><p>The number of query vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>topK: int</dt><dd><p>Get top topK values.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>IP_metric: int</dt><dd><p>0 indicates that the distance is calculated using L2, and 1 indicates that the distance is calculated using IP.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>result: tuple[numpy.ndarray, numpy.ndarray]</dt><dd><p>Returns the top topK best-matched distance values and their corresponding indexes.</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">faiss</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">vec_dims</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">database_vecs_num</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">query_vecs_num</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">nydb_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">database_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">nxquery_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">query_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

<span class="n">slice_num</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">n_bits</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">IndexPQ</span><span class="p">(</span><span class="n">vec_dims</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">,</span> <span class="n">n_bits</span><span class="p">)</span>
<span class="n">index</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">nydb_vecs</span><span class="p">)</span>
<span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nydb_vecs</span><span class="p">)</span>

<span class="c1"># save centroids</span>
<span class="n">centroids_faiss</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">pq</span><span class="o">.</span><span class="n">centroids</span>
<span class="n">centroids</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">vector_float_to_array</span><span class="p">(</span><span class="n">centroids_faiss</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;centroids.shape: &#39;</span><span class="p">,</span> <span class="n">centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;centroids_random.npy&#39;</span><span class="p">,</span> <span class="n">centroids</span><span class="p">)</span>

<span class="c1"># Compute PQ codes for the database vectors and save</span>
<span class="n">db_codes</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">pq</span><span class="o">.</span><span class="n">compute_codes</span><span class="p">(</span><span class="n">nydb_vecs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;db_codes.shape:&#39;</span><span class="p">,</span> <span class="n">db_codes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;db_codes.npy&#39;</span><span class="p">,</span> <span class="n">db_codes</span><span class="p">)</span>

<span class="c1"># faiss</span>
<span class="n">D</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nxquery_vecs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The index of faiss:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The distance of faiss:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>

<span class="c1"># test faiss_indexPQ_ADC of sail</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

<span class="c1"># get centroids</span>
<span class="n">centroids_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;centroids_random.npy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;centroids_vecs shape:&quot;</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;centroids_vecs dtype:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">centroids_vecs</span><span class="p">))</span>
<span class="c1"># get PQ codes for the database vectors</span>
<span class="n">nycodes_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;db_codes.npy&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nycodes_vecs shape:&quot;</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nycodes_vecs dtype:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">nycodes_vecs</span><span class="p">))</span>

<span class="c1"># to tensor</span>
<span class="n">centroids_tensor</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">nycode_tensor</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># D_, I_ = bmcv.faiss_indexPQ_ADC(nxquery_vecs, centroids_tensor, nycode_tensor, vec_dims, slice_num, 256, database_vecs_num, query_vecs_num, 5, 0)</span>
<span class="n">D_</span><span class="p">,</span> <span class="n">I_</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">faiss_indexPQ_ADC</span><span class="p">(</span><span class="n">nxquery_vecs</span><span class="p">,</span> <span class="n">centroids_vecs</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">database_vecs_num</span><span class="p">,</span> <span class="n">query_vecs_num</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The index of sail:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">I_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The distance of sail:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">D_</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="faiss-indexpq-sdc">
<h2><span class="section-number">5.14.50. </span>faiss_indexPQ_SDC<a class="headerlink" href="#faiss-indexpq-sdc" title="Link to this heading"></a></h2>
<p>The Symmetric Distance Computation (SDC) lookup table is used to speed up the distance calculation between PQ encodings, output the topK distances and the corresponding indices.</p>
<dl>
<dt><strong>Interface:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">faiss_indexPQ_SDC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxcodes_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sdc_table</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                <span class="n">slice_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IP_metric</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="n">faiss_indexPQ_SDC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxcodes_vecs</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">sdc_table</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
                <span class="n">slice_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroids_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">database_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">query_vecs_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">topK</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IP_metric</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</pre></div>
</div>
</dd>
</dl>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>nxcodes_vecs: numpy.ndarray</dt><dd><p>Encoded query vectors, data types are supported only numpy.uint8, and the size is query_vecs_nums * slice_num.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>nycodes_vecs: numpy.ndarray or Tensor</dt><dd><p>Encoded database vector, data types are supported only numpy.uint8 or sail.Dtype.BM_UINT8, and the size is database_vecs_nums * slice_num.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sdc_table: numpy.ndarray or Tensor</dt><dd><p>The Symmetric Distance Computation (SDC) lookup table, data types are supported only numpy.float32 or sail.Dtype.BM_FLOAT32, and the size is slice_num * centroids_num * centroids_num.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>slice_num: int</dt><dd><p>The number of slices of the original vector dimensions, for example the original vector dimension is 512, slice_num = 8, and each subvector dimension is 64.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>centroids_num: int</dt><dd><p>The number of centroids.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>database_vecs_nums: int</dt><dd><p>The number of database vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>query_vecs_nums: int</dt><dd><p>The number of query vectors.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>topK: int</dt><dd><p>Get top topK values.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>IP_metric: int</dt><dd><p>0 indicates that the distance is calculated using L2, and 1 indicates that the distance is calculated using IP.</p>
</dd>
</dl>
</li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>result: tuple[numpy.ndarray, numpy.ndarray]</dt><dd><p>Returns the top topK best-matched distance values and their corresponding indexes.</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt><strong>Sample:</strong></dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">faiss</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sophon.sail</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sail</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">vec_dims</span> <span class="o">=</span> <span class="mi">512</span>             <span class="c1"># The dimension of the vectors.</span>
<span class="n">database_vecs_num</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># The number of the database vectors.</span>
<span class="n">query_vecs_num</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># The number of the query vectors.</span>

<span class="c1"># 1. Random database and query</span>
<span class="n">database</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">database_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">query_vecs_num</span><span class="p">,</span> <span class="n">vec_dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

<span class="c1"># 2. The parameters of PQ</span>
<span class="n">slice_num</span> <span class="o">=</span> <span class="mi">8</span>       <span class="c1"># Divide the vector of the vec_dims dimension into 8 subvectors</span>
<span class="n">n_bits</span> <span class="o">=</span> <span class="mi">8</span>          <span class="c1"># centroids = 256 = 2^n_bits</span>

<span class="c1"># 3. Create a PQ index</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">IndexPQ</span><span class="p">(</span><span class="n">vec_dims</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">,</span> <span class="n">n_bits</span><span class="p">)</span>
<span class="n">index</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>  <span class="c1"># Train the PQ index</span>
<span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

<span class="c1"># 4. Set to SDC (Symmetric Distance Calculation)</span>
<span class="n">index</span><span class="o">.</span><span class="n">search_type</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">IndexPQ</span><span class="o">.</span><span class="n">ST_SDC</span>

<span class="c1"># 5. Calculate sdc_table and save it</span>
<span class="n">index</span><span class="o">.</span><span class="n">pq</span><span class="o">.</span><span class="n">compute_sdc_table</span><span class="p">()</span>

<span class="n">sdc_table</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">vector_float_to_array</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">pq</span><span class="o">.</span><span class="n">sdc_table</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sdc_table shape:&#39;</span><span class="p">,</span> <span class="n">sdc_table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;sdc_table.npy&#39;</span><span class="p">,</span> <span class="n">sdc_table</span><span class="p">)</span>

<span class="c1"># 6. Query operations using faiss</span>
<span class="n">topK</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">D</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">topK</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The index of faiss:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The distance of faiss:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>

<span class="c1"># Calculate and save the PQ encoding of the database vector (for sail test)</span>
<span class="n">db_codes</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">pq</span><span class="o">.</span><span class="n">compute_codes</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;db_codes.shape:&#39;</span><span class="p">,</span> <span class="n">db_codes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;db_codes.npy&#39;</span><span class="p">,</span> <span class="n">db_codes</span><span class="p">)</span>

<span class="c1"># Calculate and save the PQ encoding of the query vectors (for sail test)</span>
<span class="n">query_code</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">pq</span><span class="o">.</span><span class="n">compute_codes</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;query_code.shape:&#39;</span><span class="p">,</span> <span class="n">query_code</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;query_code.npy&#39;</span><span class="p">,</span> <span class="n">query_code</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;________________________________________________________________________________&quot;</span><span class="p">)</span>

<span class="c1"># test faiss_indexPQ_SDC</span>
<span class="n">handle</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">bmcv</span> <span class="o">=</span> <span class="n">sail</span><span class="o">.</span><span class="n">Bmcv</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

<span class="c1"># 1. get PQ codes of the database vectors</span>
<span class="n">nycodes_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;db_codes.npy&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nycodes_vecs shape:&quot;</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nycodes_vecs dtype:&quot;</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<span class="c1"># 2. get PQ codes of the query vectors</span>
<span class="n">nxcodes_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;query_code.npy&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nxcodes_vecs shape:&quot;</span><span class="p">,</span> <span class="n">nxcodes_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nxcodes_vecs dtype:&quot;</span><span class="p">,</span> <span class="n">nxcodes_vecs</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<span class="c1"># 3. get the SDC table</span>
<span class="n">SDC_tables</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;sdc_table.npy&#39;</span><span class="p">)</span>

<span class="n">D_</span><span class="p">,</span> <span class="n">I_</span> <span class="o">=</span> <span class="n">bmcv</span><span class="o">.</span><span class="n">faiss_indexPQ_SDC</span><span class="p">(</span><span class="n">nxcodes_vecs</span><span class="p">,</span> <span class="n">nycodes_vecs</span><span class="p">,</span> <span class="n">SDC_tables</span><span class="p">,</span> <span class="n">slice_num</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">database_vecs_num</span><span class="p">,</span> <span class="n">query_vecs_num</span><span class="p">,</span> <span class="n">topK</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The index of sail:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">I_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The distance of sail:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">D_</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sail.Decoder_RawStream.html" class="btn btn-neutral float-left" title="5.13. sail.Decoder_RawStream" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sail.Blend.html" class="btn btn-neutral float-right" title="5.15. sail.Blend" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, SOPHGO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>